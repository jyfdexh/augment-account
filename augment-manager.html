<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Augment å‡­è¯ç®¡ç†å·¥å…·</title>
    <style>
        :root{--bg:#fff;--fg:#0f172a;--muted:#64748b;--panel:#f8fafc;--bd:#e2e8f0;--chip:#eef2f7}
        @media (prefers-color-scheme: dark){
          :root{--bg:#0b1220;--fg:#e5eefc;--muted:#9fb0ca;--panel:#0e1729;--bd:#1d2a44;--chip:#0f1b33}
        }

        body {
            margin: 0;
            padding: 20px;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: var(--panel);
            color: var(--fg);
            min-height: 100vh;
        }

        .main-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: var(--bg);
            border-radius: 18px;
            box-shadow: 0 4px 12px -4px rgba(0,0,0,.18);
        }

        .main-header h1 {
            margin: 0 0 10px 0;
            font-size: 28px;
            color: var(--fg);
        }

        .main-header p {
            margin: 0;
            color: var(--muted);
            font-size: 14px;
        }

        .main-nav {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: flex-start;
        }

        .nav-buttons {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
        }

        .btn-primary:hover {
            background: #2563eb;
        }

        .btn-secondary {
            background: var(--chip);
            color: var(--fg);
            border: 1px solid var(--bd);
        }

        .btn-secondary:hover {
            background: var(--bd);
        }

        .btn-ghost {
            background: transparent;
            color: var(--muted);
            border: 1px solid var(--bd);
        }

        .btn-ghost:hover {
            background: var(--chip);
            color: var(--fg);
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
        }

        .status-box {
            background: var(--bg);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px -2px rgba(0,0,0,.1);
        }

        .spin {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid var(--bd);
            border-top: 2px solid var(--fg);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .stat-item {
            color: var(--muted);
            font-size: 14px;
        }

        /* å‡­è¯åˆ†ç±»åŒºåŸŸæ ·å¼ */
        .credential-section {
            transition: all 0.3s ease;
        }

        .credential-section .section-header:hover {
            background: var(--chip);
            border-color: var(--muted);
        }

        .credential-section.expanded .arrow-icon {
            transform: rotate(0deg);
        }

        .credential-section.collapsed .arrow-icon {
            transform: rotate(-90deg);
        }

        .section-content {
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .section-content.collapsing {
            opacity: 0.5;
        }
        /* === Cyberpunk Theme (scoped by body.theme-cyber) === */
        body.theme-cyber {
            --bg:#060914;           /* Deep night */
            --fg:#E6F0FF;           /* Ice white */
            --muted:#82A0FF;        /* Neon soft blue */
            --panel:#050A16;        /* Panel dark */
            --bd:#1B2A4A;           /* Border blue */
            --chip:#0A1530;         /* Chip bg */
            background: radial-gradient(1200px 600px at 80% -20%, rgba(101,64,219,0.25) 0%, rgba(5,10,22,0) 65%),
                        radial-gradient(900px 500px at -20% 120%, rgba(0,230,230,0.2) 0%, rgba(5,10,22,0) 60%),
                        var(--panel);
            color: var(--fg);
            min-height: 100vh;
        }
        body.theme-cyber::before {
            content: '';
            position: fixed;
            inset: 0;
            background:
                linear-gradient(transparent 95%, rgba(130,160,255,0.06) 95%),
                linear-gradient(90deg, transparent 95%, rgba(130,160,255,0.06) 95%);
            background-size: 100% 20px, 20px 100%;
            pointer-events: none;
            z-index: 0;
        }
        body.theme-cyber::after {
            content: '';
            position: fixed;
            inset: 0;
            background: linear-gradient(180deg, rgba(255,255,255,0.06) 0, rgba(255,255,255,0.02) 2px, transparent 2px);
            background-size: 100% 3px;
            mix-blend-mode: overlay;
            opacity: .25;
            pointer-events: none;
            z-index: 0;
            animation: scan 8s linear infinite;
        }
        @keyframes scan {
            0% { background-position-y: 0; }
            100% { background-position-y: 1000px; }
        }

        .theme-cyber .main-header,
        .theme-cyber .status-box,
        .theme-cyber .btn,
        .theme-cyber .section-header {
            position: relative;
            background: linear-gradient(180deg, rgba(10,21,48,.9), rgba(7,14,32,.9));
            border: 1px solid rgba(130,160,255,.22);
            box-shadow:
              0 0 0 1px rgba(130,160,255,.15) inset,
              0 10px 30px -12px rgba(0,0,0,.55),
              0 0 18px rgba(101,64,219,.18);
            z-index: 1; /* Ensure UI above canvas and overlays */
        }

        .theme-cyber .btn-primary {
            background: linear-gradient(135deg,#5B8CFF 0%, #6F7DFF 35%, #8A55FF 100%);
            border: 1px solid rgba(130,160,255,.35);
            color: #fff;
            text-shadow: 0 1px 8px rgba(255,255,255,.25);
        }
        .theme-cyber .btn-primary:hover {
            filter: brightness(1.08) saturate(1.1);
            box-shadow: 0 0 22px rgba(111,125,255,.35), 0 0 8px rgba(90,188,255,.2) inset;
        }
        .theme-cyber .btn-secondary,
        .theme-cyber .btn-ghost {
            background: rgba(11,21,48,.4);
            border: 1px solid rgba(130,160,255,.25);
            color: var(--fg);
        }
        .theme-cyber .btn-secondary:hover,
        .theme-cyber .btn-ghost:hover {
            background: rgba(17,30,64,.6);
            box-shadow: 0 0 18px rgba(130,160,255,.22);
        }

        .theme-cyber .main-nav { z-index: 1; }
        .theme-cyber .stat-item { color: var(--muted); }

        .theme-cyber .credential-section .section-header:hover {
            background: rgba(20,35,80,.55);
            border-color: rgba(130,160,255,.4);
        }

        .theme-cyber .arrow-icon {
            transition: transform .25s ease, filter .25s ease;
            filter: drop-shadow(0 0 6px rgba(130,160,255,.45));
        }

        /* chips */
        .theme-cyber .chip {
            background: rgba(10,21,48,.6);
            border: 1px solid rgba(130,160,255,.25);
            color: var(--fg);
        }

        /* scrollbars */
        .theme-cyber ::-webkit-scrollbar { height: 10px; width: 10px; }
        .theme-cyber ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg,#6F7DFF,#8A55FF);
            border-radius: 10px;
        }

        /* subtle glow borders for panels */
        .theme-cyber .panel,
        .theme-cyber .status-box,
        .theme-cyber #main-content {
            border: 1px solid rgba(130,160,255,.18);
            background: rgba(5,10,22,.65);
            backdrop-filter: blur(6px) saturate(1.1);
        }
        /* === End Cyberpunk Theme === */

        /* === Progress Bar Styles - ç®€çº¦ç°ä»£é£æ ¼ === */
        .progress-container {
            background: linear-gradient(135deg, var(--panel) 0%, var(--chip) 100%);
            border: 1px solid var(--bd);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
            height: 10px;
            margin: 3px 0;
            box-shadow: 0 1px 2px -1px rgba(0,0,0,0.1);
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%);
            border-radius: 5px;
            position: relative;
            transition: width 1.2s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            box-shadow: 0 0 6px rgba(16, 185, 129, 0.2);
        }

        .progress-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg,
                transparent 0%,
                rgba(255,255,255,0.1) 25%,
                rgba(255,255,255,0.25) 50%,
                rgba(255,255,255,0.1) 75%,
                transparent 100%);
            animation: progressShine 3s infinite ease-in-out;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 40%;
            background: linear-gradient(180deg, rgba(255,255,255,0.15) 0%, transparent 100%);
            border-radius: 5px 5px 0 0;
        }

        @keyframes progressShine {
            0% { left: -100%; opacity: 0; }
            50% { opacity: 1; }
            100% { left: 100%; opacity: 0; }
        }

        /* {{ AURA-X: Add - å¢å¼ºè¿›åº¦æ¡åŠ¨æ€ç‚«é…·æ•ˆæœ. Approval: å¯¸æ­¢(ID:1735308000). }} */
        /* å¢å¼ºåŠ¨æ€æ•ˆæœ - è„‰å†²åŠ¨ç”» */
        @keyframes progressPulse {
            0%, 100% {
                box-shadow: 0 0 6px rgba(16, 185, 129, 0.2),
                           0 0 12px rgba(16, 185, 129, 0.1);
            }
            50% {
                box-shadow: 0 0 12px rgba(16, 185, 129, 0.4),
                           0 0 24px rgba(16, 185, 129, 0.2),
                           0 0 36px rgba(16, 185, 129, 0.1);
            }
        }

        /* å¢å¼ºåŠ¨æ€æ•ˆæœ - æµå…‰åŠ¨ç”» */
        @keyframes progressFlow {
            0% {
                background-position: -200% 0;
                opacity: 0.6;
            }
            50% {
                opacity: 1;
            }
            100% {
                background-position: 200% 0;
                opacity: 0.6;
            }
        }

        /* å¢å¼ºåŠ¨æ€æ•ˆæœ - è¾¹æ¡†å…‰æ™• */
        @keyframes progressGlow {
            0%, 100% {
                border-color: rgba(16, 185, 129, 0.3);
            }
            50% {
                border-color: rgba(16, 185, 129, 0.8);
            }
        }

        /* {{ AURA-X: Add - è¶…çº§ç‚«é…·åŠ¨æ€æ•ˆæœå¢å¼º. Approval: å¯¸æ­¢(ID:1735308000). }} */
        /* è¶…åŠ¨æ€å½©è™¹æµå…‰ */
        @keyframes rainbowFlow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* è¶…åŠ¨æ€ç²’å­æ•ˆæœ */
        @keyframes particleFloat {
            0%, 100% {
                transform: translateY(0px) scale(1);
                opacity: 0.3;
            }
            25% {
                transform: translateY(-8px) scale(1.2);
                opacity: 0.8;
            }
            50% {
                transform: translateY(-4px) scale(0.9);
                opacity: 1;
            }
            75% {
                transform: translateY(-12px) scale(1.1);
                opacity: 0.6;
            }
        }

        /* è¶…åŠ¨æ€æ³¢æµªæ•ˆæœ */
        @keyframes waveEffect {
            0% {
                transform: translateX(-100%) skewX(0deg);
                opacity: 0;
            }
            25% {
                transform: translateX(-50%) skewX(5deg);
                opacity: 0.7;
            }
            50% {
                transform: translateX(0%) skewX(-5deg);
                opacity: 1;
            }
            75% {
                transform: translateX(50%) skewX(3deg);
                opacity: 0.7;
            }
            100% {
                transform: translateX(100%) skewX(0deg);
                opacity: 0;
            }
        }

        /* è¶…åŠ¨æ€é—ªçƒæ˜Ÿå…‰ */
        @keyframes starBlink {
            0%, 100% {
                opacity: 0;
                transform: scale(0.5) rotate(0deg);
            }
            20% {
                opacity: 0.3;
                transform: scale(0.8) rotate(45deg);
            }
            50% {
                opacity: 1;
                transform: scale(1.2) rotate(90deg);
            }
            80% {
                opacity: 0.6;
                transform: scale(0.9) rotate(135deg);
            }
        }

        /* {{ AURA-X: Modify - è¶…çº§ç‚«é…·è¿›åº¦æ¡åŠ¨æ€æ•ˆæœ. Approval: å¯¸æ­¢(ID:1735308000). }} */
        /* è¶…çº§ç‚«é…·è¿›åº¦æ¡ä¸»ä½“ */
        .progress-bar {
            animation: progressPulse 1.5s ease-in-out infinite,
                      rainbowFlow 3s ease-in-out infinite;
            background: linear-gradient(45deg,
                #10b981 0%,
                #06d6a0 15%,
                #118ab2 30%,
                #073b4c 45%,
                #118ab2 60%,
                #06d6a0 75%,
                #10b981 90%,
                #34d399 100%);
            background-size: 400% 100%;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.4),
                       inset 0 1px 0 rgba(255,255,255,0.2);
        }

        /* è¶…çº§ç‚«é…·æµå…‰æ•ˆæœ */
        .progress-bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            animation: progressShine 2s infinite ease-in-out,
                      waveEffect 3s infinite linear;
            background: linear-gradient(90deg,
                transparent 0%,
                rgba(255,255,255,0.1) 10%,
                rgba(255,255,255,0.3) 25%,
                rgba(255,255,255,0.6) 40%,
                rgba(255,255,255,0.8) 50%,
                rgba(255,255,255,0.6) 60%,
                rgba(255,255,255,0.3) 75%,
                rgba(255,255,255,0.1) 90%,
                transparent 100%);
            z-index: 1;
        }

        /* è¶…çº§ç‚«é…·ç²’å­æ•ˆæœ */
        .progress-bar::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 20%;
            width: 4px;
            height: 4px;
            background: rgba(255,255,255,0.8);
            border-radius: 50%;
            animation: particleFloat 2.5s infinite ease-in-out,
                      starBlink 1.8s infinite ease-in-out;
            box-shadow:
                10px -5px 0 rgba(255,255,255,0.6),
                25px 3px 0 rgba(255,255,255,0.4),
                40px -8px 0 rgba(255,255,255,0.7),
                55px 2px 0 rgba(255,255,255,0.5);
            z-index: 2;
        }

        /* è¶…çº§ç‚«é…·å®¹å™¨å…‰æ™• */
        .progress-container {
            animation: progressGlow 2s ease-in-out infinite;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.2);
        }

        /* è¶…çº§ç‚«é…·å®¹å™¨èƒŒæ™¯æ³¢çº¹ */
        .progress-container::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle,
                rgba(16, 185, 129, 0.05) 0%,
                transparent 50%);
            animation: particleFloat 4s infinite ease-in-out reverse;
            z-index: 0;
        }

        /* {{ AURA-X: Remove - å»æ‰è¿›åº¦æ¡ç™¾åˆ†æ¯”æ˜¾ç¤ºæ ·å¼. Approval: å¯¸æ­¢(ID:1735308000). }} */
        .progress-text {
            display: none; /* éšè—ç™¾åˆ†æ¯”æ–‡å­— */
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
            color: var(--muted);
            margin-bottom: 4px;
            font-weight: 500;
        }

        /* Large progress bar for summary - ç®€çº¦ç°ä»£é£æ ¼ */
        .summary-progress {
            height: 16px;
            border-radius: 8px;
            background: linear-gradient(135deg, var(--panel) 0%, var(--chip) 100%);
            border: 1px solid var(--bd);
            box-shadow: 0 1px 4px -1px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .summary-progress::before {
            content: '';
            position: absolute;
            inset: 1px;
            border-radius: 11px;
            background: linear-gradient(135deg, transparent 0%, rgba(255,255,255,0.03) 50%, transparent 100%);
            pointer-events: none;
        }

        .summary-progress .progress-bar {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 50%, #1d4ed8 100%);
            border-radius: 11px;
            position: relative;
            box-shadow: 0 0 12px rgba(59, 130, 246, 0.25);
        }

        .summary-progress .progress-bar::before {
            background: linear-gradient(90deg,
                transparent 0%,
                rgba(255,255,255,0.15) 25%,
                rgba(255,255,255,0.3) 50%,
                rgba(255,255,255,0.15) 75%,
                transparent 100%);
            animation: progressShine 3s infinite ease-in-out;
        }

        .summary-progress .progress-text {
            font-size: 13px;
            font-weight: 700;
            color: #ffffff !important;
            text-shadow:
                0 1px 3px rgba(0,0,0,0.9),
                0 0 6px rgba(0,0,0,0.8),
                1px 1px 0 rgba(0,0,0,0.8),
                -1px -1px 0 rgba(0,0,0,0.8),
                1px -1px 0 rgba(0,0,0,0.8),
                -1px 1px 0 rgba(0,0,0,0.8);
            letter-spacing: 0.3px;
        }

        /* {{ AURA-X: Modify - å¢å¼ºèµ›åšé£ä¸»é¢˜è¿›åº¦æ¡åŠ¨æ€æ•ˆæœ. Approval: å¯¸æ­¢(ID:1735308000). }} */
        /* Cyberpunk theme progress bars - å¢å¼ºåŠ¨æ€æ•ˆæœ */
        .theme-cyber .progress-container {
            background: linear-gradient(135deg, rgba(10,21,48,.7) 0%, rgba(7,14,32,.8) 100%);
            border: 1px solid rgba(130,160,255,.3);
            box-shadow: 0 0 8px rgba(130,160,255,.15);
            animation: progressGlow 3s ease-in-out infinite;
        }

        .theme-cyber .progress-bar {
            background: linear-gradient(135deg,
                #6F7DFF 0%,
                #8A55FF 25%,
                #5B8CFF 50%,
                #8A55FF 75%,
                #6F7DFF 100%);
            background-size: 200% 100%;
            animation: progressPulse 2s ease-in-out infinite;
        }

        .theme-cyber .progress-bar::before {
            background: linear-gradient(90deg,
                transparent 0%,
                rgba(130,160,255,0.2) 20%,
                rgba(130,160,255,0.5) 40%,
                rgba(255,255,255,0.6) 50%,
                rgba(130,160,255,0.5) 60%,
                rgba(130,160,255,0.2) 80%,
                transparent 100%);
            animation: progressShine 3s infinite ease-in-out,
                      progressFlow 4s infinite linear;
        }

        /* èµ›åšé£ä¸»é¢˜çš„è„‰å†²åŠ¨ç”» */
        @keyframes cyberProgressPulse {
            0%, 100% {
                box-shadow: 0 0 12px rgba(111,125,255,.3),
                           0 0 24px rgba(130,160,255,.1);
            }
            50% {
                box-shadow: 0 0 24px rgba(111,125,255,.6),
                           0 0 48px rgba(130,160,255,.3),
                           0 0 72px rgba(101,64,219,.2);
            }
        }

        .theme-cyber .progress-bar {
            animation: cyberProgressPulse 2s ease-in-out infinite;
        }

        .theme-cyber .summary-progress {
            background: linear-gradient(135deg,
                rgba(10,21,48,.8) 0%,
                rgba(7,14,32,.9) 100%);
            border: 1px solid rgba(130,160,255,.4);
            box-shadow: 0 0 15px rgba(101,64,219,.2);
        }

        .theme-cyber .summary-progress::before {
            background: linear-gradient(135deg,
                transparent 0%,
                rgba(130,160,255,0.08) 50%,
                transparent 100%);
        }

        .theme-cyber .summary-progress .progress-bar {
            background: linear-gradient(135deg, #5B8CFF 0%, #6F7DFF 50%, #8A55FF 100%);
            box-shadow: 0 0 18px rgba(111,125,255,.4);
        }

        .theme-cyber .summary-progress .progress-bar::before {
            background: linear-gradient(90deg,
                transparent 0%,
                rgba(130,160,255,0.25) 25%,
                rgba(255,255,255,0.4) 50%,
                rgba(130,160,255,0.25) 75%,
                transparent 100%);
        }

        /* Warning/Error progress colors */
        .progress-bar.warning {
            background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 25%, #fcd34d 50%, #fde047 75%, #facc15 100%);
            box-shadow: 0 0 25px rgba(245, 158, 11, 0.4), 0 0 50px rgba(251, 191, 36, 0.2);
        }

        .progress-bar.danger {
            background: linear-gradient(135deg, #dc2626 0%, #ef4444 25%, #f87171 50%, #fca5a5 75%, #fecaca 100%);
            box-shadow: 0 0 25px rgba(220, 38, 38, 0.4), 0 0 50px rgba(239, 68, 68, 0.2);
        }

        .theme-cyber .progress-bar.warning {
            background: linear-gradient(135deg, #FF8A55 0%, #FFB366 25%, #FFCC77 50%, #FFD588 75%, #FFDD99 100%);
            box-shadow: 0 0 25px rgba(255,138,85,.6), 0 0 50px rgba(255,179,102,.3);
        }

        .theme-cyber .progress-bar.danger {
            background: linear-gradient(135deg, #FF5555 0%, #FF7777 25%, #FF9999 50%, #FFAAAA 75%, #FFBBBB 100%);
            box-shadow: 0 0 25px rgba(255,85,85,.6), 0 0 50px rgba(255,119,119,.3);
        }


        /* Responsive adjustments */
        @media (max-width: 768px) {
            .main-nav {
                gap: 8px;
            }

            .btn {
                padding: 8px 12px;
                font-size: 13px;
            }
        }
        /* === End Pie Chart Styles === */

        /* === End Progress Bar Styles === */
    </style>
</head>
<body>
    <div class="main-header">
        <h1>ğŸ”‘ Augment å‡­è¯ç®¡ç†</h1>
        <p>ç®¡ç†æ‚¨çš„ Augment è´¦æˆ·å‡­è¯å’Œè®¢é˜…ä¿¡æ¯</p>
    </div>
    
    <div class="main-nav">
        <button id="nav-auth" class="btn btn-primary">ğŸš€ è·å–ä»¤ç‰Œ</button>
        <button id="nav-checkall" class="btn btn-ghost">ğŸ”„ å…¨éƒ¨æ£€æµ‹</button>
        <button id="nav-import" class="btn btn-ghost">ğŸ“¥ å¯¼å…¥æ•°æ®</button>
        <button id="nav-export" class="btn btn-ghost">ğŸ“¤ å¯¼å‡ºæ•°æ®</button>
        <button id="nav-sync" class="btn btn-ghost">â˜ï¸ äº‘åŒæ­¥</button>
        <button id="nav-proxy" class="btn btn-ghost">ğŸŒ ä»£ç†é…ç½®</button>
        <button id="nav-theme" class="btn btn-secondary" aria-label="åˆ‡æ¢ä¸»é¢˜">ğŸŒ™</button>
    </div>

    <div id="status" class="status-box">
        <div id="loading">
            <span class="spin"></span>
            æ­£åœ¨åˆå§‹åŒ–...
        </div>
        <div id="ready" style="display: none;">
            <!-- {{ AURA-X: Remove - å»æ‰ç³»ç»Ÿå°±ç»ªæç¤ºæ–‡æœ¬. Approval: å¯¸æ­¢(ID:1735308000). }} -->
        </div>
    </div>


    <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
    <div id="main-content" style="margin-top: 20px;">
        <!-- è¿™é‡Œå°†æ˜¾ç¤ºå‡­è¯ç®¡ç†ç•Œé¢ -->
    </div>

    <!-- å¼•å…¥CORSä»£ç†é…ç½® -->
    <script src="cors-proxy-config.js"></script>

    <script>
        console.log('å¼€å§‹åŠ è½½è„šæœ¬...');

        // æ³¨å†Œ Service Workerï¼ˆå¯é€‰ï¼‰
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('cors-proxy-sw.js')
                .then(registration => console.log('ğŸ”§ Service Worker æ³¨å†ŒæˆåŠŸ'))
                .catch(error => console.log('Service Worker æ³¨å†Œå¤±è´¥:', error));
        }
        
        // åŸºç¡€å·¥å…·å‡½æ•°
        const $ = s => document.querySelector(s);
        const json = s => { try { return JSON.parse(s); } catch { return null; } };
        const now = () => Date.now();
        
        // ç®€å•çš„å­˜å‚¨ç®¡ç†
        const store = {
            get: () => {
                try {
                    const data = localStorage.getItem('augment_creds') || '[]';
                    return JSON.parse(data);
                } catch {
                    return [];
                }
            },
            set: list => {
                try {
                    localStorage.setItem('augment_creds', JSON.stringify(list || []));
                    return true;
                } catch {
                    return false;
                }
            }
        };
        
        // GitHub Gist åŒæ­¥ç®¡ç†
        const gistSync = {
            getConfig: () => {
                try {
                    const config = localStorage.getItem('gist_sync_config');
                    return config ? JSON.parse(config) : { token: '', gistId: '', autoSync: false };
                } catch {
                    return { token: '', gistId: '', autoSync: false };
                }
            },
            
            setConfig: (config) => {
                try {
                    localStorage.setItem('gist_sync_config', JSON.stringify(config));
                    return true;
                } catch {
                    return false;
                }
            },
            
            async upload(data, token, gistId = null) {
                const url = gistId 
                    ? `https://api.github.com/gists/${gistId}`
                    : 'https://api.github.com/gists';
                
                const response = await fetch(url, {
                    method: gistId ? 'PATCH' : 'POST',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/vnd.github.v3+json'
                    },
                    body: JSON.stringify({
                        description: 'Augment Account Credentials - Auto Sync',
                        public: false,
                        files: {
                            'augment-creds.json': {
                                content: JSON.stringify({
                                    data: data,
                                    lastSync: new Date().toISOString(),
                                    version: '1.0'
                                }, null, 2)
                            }
                        }
                    })
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(`GitHub APIé”™è¯¯: ${error.message || response.statusText}`);
                }
                
                return response.json();
            },
            
            async download(token, gistId) {
                const response = await fetch(`https://api.github.com/gists/${gistId}`, {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(`GitHub APIé”™è¯¯: ${error.message || response.statusText}`);
                }
                
                const gist = await response.json();
                const file = gist.files['augment-creds.json'];
                
                if (!file) {
                    throw new Error('Gistä¸­æœªæ‰¾åˆ°å‡­è¯æ–‡ä»¶');
                }
                
                const content = JSON.parse(file.content);
                return {
                    data: content.data || [],
                    lastSync: content.lastSync,
                    version: content.version
                };
            },
            
            async sync(direction = 'upload') {
                const config = this.getConfig();
                if (!config.token) {
                    throw new Error('è¯·å…ˆé…ç½® GitHub Token');
                }
                
                if (direction === 'upload') {
                    const localData = store.get();
                    const result = await this.upload(localData, config.token, config.gistId);
                    
                    // ä¿å­˜ Gist IDï¼ˆé¦–æ¬¡ä¸Šä¼ æ—¶ï¼‰
                    if (!config.gistId) {
                        config.gistId = result.id;
                        this.setConfig(config);
                    }
                    
                    return { direction: 'upload', count: localData.length, gistId: result.id };
                } else {
                    if (!config.gistId) {
                        throw new Error('è¯·å…ˆé…ç½® Gist ID æˆ–è¿›è¡Œé¦–æ¬¡ä¸Šä¼ ');
                    }
                    
                    const cloudData = await this.download(config.token, config.gistId);
                    store.set(cloudData.data);
                    
                    return { direction: 'download', count: cloudData.data.length, lastSync: cloudData.lastSync };
                }
            }
        };
        
        // ä¸»é¢˜åˆ‡æ¢ï¼ˆä¸å½±å“ä¸šåŠ¡é€»è¾‘ï¼‰
        const THEME_KEY = 'ui_theme';
        function setThemeButtonLabel() {
            const btn = document.querySelector('#nav-theme');
            if (!btn) return;
            const isCyber = document.body.classList.contains('theme-cyber');
            // Show icon only: ğŸŒ for cyber (dark-ish) theme, ğŸŒ™ for default (light) theme
            btn.textContent = isCyber ? 'ğŸŒ' : 'ğŸŒ™';
            btn.classList.toggle('btn-primary', isCyber);
            btn.classList.toggle('btn-secondary', !isCyber);
        }
        function applyTheme(theme) {
            const isCyber = theme === 'cyber';
            document.body.classList.toggle('theme-cyber', isCyber);
            try { localStorage.setItem(THEME_KEY, isCyber ? 'cyber' : 'default'); } catch {}
            setThemeButtonLabel();
        }
        function toggleTheme() {
            const isCyber = document.body.classList.contains('theme-cyber');
            applyTheme(isCyber ? 'default' : 'cyber');
        }

        // ï¼ˆå·²å›é€€â€œç»ˆæé¢„è®¾â€åŠ¨æ€ç‰¹æ•ˆï¼Œä¿ç•™åŸºç¡€ä¸»é¢˜æ ·å¼ä¸åˆ‡æ¢ï¼‰
        
        // æ”¹è¿›çš„UIæç¤ºç³»ç»Ÿ
        function showToast(message, type = 'info', duration = 3000) {
            const toast = document.createElement('div');
            const bgColor = type === 'success' ? '#f0fdf4' : type === 'error' ? '#fef2f2' : type === 'warning' ? '#fef3c7' : '#f0f9ff';
            const textColor = type === 'success' ? '#16a34a' : type === 'error' ? '#dc2626' : type === 'warning' ? '#92400e' : '#0369a1';
            const icon = type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : type === 'warning' ? 'âš ï¸' : 'â„¹ï¸';

            toast.style.cssText = `
                position: fixed; top: 20px; right: 20px; z-index: 10000;
                background: ${bgColor}; color: ${textColor}; border: 1px solid;
                border-radius: 12px; padding: 12px 16px; box-shadow: 0 4px 12px rgba(0,0,0,.15);
                max-width: 350px; word-wrap: break-word; font-size: 14px;
                display: flex; align-items: center; gap: 8px;
            `;
            toast.innerHTML = `<span>${icon}</span><span>${message}</span>`;
            document.body.appendChild(toast);

            // å¦‚æœæ˜¯é”™è¯¯æ¶ˆæ¯ï¼Œæ˜¾ç¤ºæ—¶é—´æ›´é•¿
            const actualDuration = type === 'error' ? Math.max(duration, 5000) : duration;
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.remove();
                }
            }, actualDuration);
        }

        // æ˜¾ç¤ºè¯¦ç»†é”™è¯¯ä¿¡æ¯çš„å‡½æ•°
        function showDetailedError(title, details, solutions = []) {
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed; inset: 0; background: rgba(0,0,0,.5); z-index: 9999;
                display: flex; align-items: center; justify-content: center;
            `;

            const dialog = document.createElement('div');
            dialog.style.cssText = `
                background: var(--bg); border-radius: 12px; padding: 20px;
                max-width: 500px; width: 90vw; box-shadow: 0 25px 60px -12px rgba(0,0,0,.28);
            `;

            const solutionsHtml = solutions.length > 0 ? `
                <div style="margin-top: 15px;">
                    <strong>å»ºè®®è§£å†³æ–¹æ¡ˆï¼š</strong>
                    <ul style="margin: 8px 0; padding-left: 20px;">
                        ${solutions.map(s => `<li style="margin: 4px 0;">${s}</li>`).join('')}
                    </ul>
                </div>
            ` : '';

            dialog.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h3 style="margin: 0; color: #dc2626;">âŒ ${title}</h3>
                    <button id="close-error" class="btn btn-ghost">âœ•</button>
                </div>
                <div style="color: var(--muted); margin-bottom: 15px; font-size: 14px;">
                    ${details}
                </div>
                ${solutionsHtml}
                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 15px;">
                    <button id="retry-with-proxy" class="btn btn-primary">ä½¿ç”¨ä»£ç†é‡è¯•</button>
                    <button id="open-cors-solutions" class="btn btn-secondary">æŸ¥çœ‹æ–¹æ¡ˆ</button>
                    <button id="retry-connection" class="btn btn-secondary">é‡è¯•è¿æ¥</button>
                </div>
            `;

            overlay.appendChild(dialog);
            document.body.appendChild(overlay);

            // ç»‘å®šäº‹ä»¶
            dialog.querySelector('#close-error').onclick = () => overlay.remove();
            dialog.querySelector('#retry-with-proxy').onclick = async () => {
                overlay.remove();
                // CORSåŠŸèƒ½å·²åˆ é™¤
            };
            dialog.querySelector('#open-cors-solutions').onclick = () => {
                overlay.remove();
                // CORSåŠŸèƒ½å·²åˆ é™¤
            };
            dialog.querySelector('#retry-connection').onclick = () => {
                overlay.remove();
                // CORSåŠŸèƒ½å·²åˆ é™¤
            };

            overlay.onclick = (e) => {
                if (e.target === overlay) overlay.remove();
            };
        }
        
        // é…ç½®å¸¸é‡
        const CFG = {
            clientID: 'v',
            authURL: 'https://auth.augmentcode.com/authorize',
            orbAPI: 'https://portal.withorb.com/api/v1',
            pricingUnit: 'jWTJo9ptbapMWkvg',
            CONCURRENCY: 4,
            PAGE_SIZE: 18,
            // æ™ºèƒ½ä»£ç†ç®¡ç†å™¨
            proxyManager: null,
            // APIè¿æ¥çŠ¶æ€
            API_STATUS: {
                auth: 'unknown',
                orb: 'unknown'
            }
        };

        // å·¥å…·å‡½æ•°ï¼ˆä»Augment.jsç§»æ¤ï¼‰
        const rand = n => {
            const a = new Uint8Array(n);
            crypto.getRandomValues(a);
            return btoa(String.fromCharCode(...a)).replace(/\+/g,'-').replace(/\//g,'_').replace(/=/g,'');
        };
        const sha256 = s => crypto.subtle.digest('SHA-256', new TextEncoder().encode(s));
        const b64url = buf => btoa(String.fromCharCode(...new Uint8Array(buf))).replace(/\+/g,'-').replace(/\//g,'_').replace(/=/g,'');

        // æ™ºèƒ½fetchåŒ…è£…å™¨ï¼šGET ä¼˜å…ˆä»£ç†ï¼›éGET å…ˆç›´è¿åä»£ç†
        const safeFetch = async (url, options = {}) => {
            // ç¡®ä¿ä»£ç†ç®¡ç†å™¨å·²åˆå§‹åŒ–
            if (!CFG.proxyManager && window.SmartCORSProxy) {
                try {
                    const ok = await window.SmartCORSProxy.init();
                    if (ok) CFG.proxyManager = window.SmartCORSProxy;
                } catch (e) {
                    console.log('åˆå§‹åŒ–CORSä»£ç†å¤±è´¥:', e?.message);
                }
            }

            const method = (options.method || 'GET').toUpperCase();

            // GET: ä¼˜å…ˆä»£ç†
            if (method === 'GET' && CFG.proxyManager) {
                try {
                    const proxyResponse = await CFG.proxyManager.fetch(url, {
                        ...options,
                        headers: {
                            ...options.headers,
                            'Accept': 'application/json'
                        }
                    });
                    // ä»£ç†è¿”å› 401/403 å¯èƒ½æºè‡ªä»£ç†é™åˆ¶ï¼ˆæœªæ¿€æ´»/é¢„æ£€ç­‰ï¼‰ï¼Œè§¦å‘ç›´è¿å›é€€
                    if (proxyResponse.status === 401 || proxyResponse.status === 403) {
                        throw new Error('ä»£ç†æœªæˆæƒæˆ–ç¦æ­¢ï¼Œè§¦å‘ç›´è¿å›é€€');
                    }
                    return proxyResponse;
                } catch (proxyError) {
                    console.log('ä»£ç†è¯·æ±‚å¤±è´¥ï¼Œå°è¯•ç›´æ¥è¯·æ±‚:', proxyError.message);
                }
            }

            // ç›´è¿å°è¯•ï¼ˆéGETä¼˜å…ˆï¼›æˆ–GETçš„ä»£ç†å¤±è´¥æ—¶å›é€€ï¼‰
            try {
                const response = await fetch(url, {
                    ...options,
                    mode: 'cors',
                    credentials: 'omit',
                    headers: {
                        ...options.headers,
                        'Accept': 'application/json'
                    }
                });
                if (response.status === 401) {
                    throw new Error('è®¤è¯å¤±è´¥');
                }
                return response;
            } catch (directErr) {
                // éGETï¼šç›´è¿å¤±è´¥å†å°è¯•ä»£ç†
                if (method !== 'GET' && CFG.proxyManager) {
                    try {
                        const proxyResponse = await CFG.proxyManager.fetch(url, {
                            ...options,
                            headers: {
                                ...options.headers,
                                'Accept': 'application/json'
                            }
                        });
                        if (proxyResponse.status === 401) {
                            throw new Error('è®¤è¯å¤±è´¥');
                        }
                        return proxyResponse;
                    } catch (proxyErr) {
                        console.log('ç›´è¿ä¸ä»£ç†å‡å¤±è´¥:', proxyErr.message);
                        throw proxyErr;
                    }
                }
                throw directErr;
            }
        };

        // OAuth è®¤è¯ç›¸å…³ï¼ˆå®Œæ•´å®ç°ï¼‰
        const oauth = {
            async start() {
                const email = await this.getEmailFromUser();
                if (!email || !email.includes('@')) return;

                try {
                    const verifier = rand(64);
                    const challenge = b64url(await sha256(verifier));
                    const state = rand(16);

                    // ä¿å­˜è®¤è¯çŠ¶æ€
                    localStorage.setItem('oauth_state', JSON.stringify({ verifier, challenge, state, email }));

                    // æ„å»ºè®¤è¯URL
                    const params = new URLSearchParams({
                        response_type: 'code',
                        client_id: CFG.clientID,
                        code_challenge: challenge,
                        code_challenge_method: 'S256',
                        state: state,
                        prompt: 'login'
                    });

                    const authURL = `${CFG.authURL}?${params}`;
                    showToast('æ­£åœ¨æ‰“å¼€è®¤è¯é¡µé¢...', 'info');
                    window.open(authURL, '_blank');

                } catch (error) {
                    console.error('OAuthå¯åŠ¨å¤±è´¥:', error);
                    showToast('è®¤è¯å¯åŠ¨å¤±è´¥: ' + error.message, 'error');
                }
            },

            async getEmailFromUser() {
                return new Promise((resolve) => {
                    // åˆ›å»ºé‚®ç®±è¾“å…¥å¯¹è¯æ¡†
                    const overlay = document.createElement('div');
                    overlay.style.cssText = `
                        position: fixed; inset: 0; background: rgba(0,0,0,.5); z-index: 9999;
                        display: flex; align-items: center; justify-content: center;
                    `;

                    const dialog = document.createElement('div');
                    dialog.style.cssText = `
                        background: var(--bg); border-radius: 12px; padding: 20px;
                        max-width: 400px; width: 90vw; box-shadow: 0 25px 60px -12px rgba(0,0,0,.28);
                    `;

                    dialog.innerHTML = `
                        <h3 style="margin: 0 0 16px 0; color: var(--fg);">ğŸš€ è·å–ä»¤ç‰Œ</h3>
                        <div style="display: flex; gap: 8px; align-items: center; margin-bottom: 16px;">
                            <input id="email-name" style="
                                flex: 1; padding: 8px 10px; border: 1px solid var(--bd);
                                border-radius: 8px; background: var(--bg); color: var(--fg);
                            " placeholder="é‚®ç®±æœ¬åœ°å æˆ– å®Œæ•´é‚®ç®±"/>
                            <select id="email-domain" style="
                                padding: 8px 10px; border: 1px solid var(--bd);
                                border-radius: 8px; background: var(--bg); color: var(--fg);
                            ">
                                <option value="@outlook.com">@outlook.com</option>
                                <option value="@gmail.com">@gmail.com</option>
                                <option value="@hotmail.com">@hotmail.com</option>
                            </select>
                        </div>
                        <div style="display: flex; gap: 8px; justify-content: flex-end;">
                            <button id="cancel-btn" class="btn btn-secondary">å–æ¶ˆ</button>
                            <button id="ok-btn" class="btn btn-primary">ç¡®å®š</button>
                        </div>
                    `;

                    overlay.appendChild(dialog);
                    document.body.appendChild(overlay);

                    const nameInput = dialog.querySelector('#email-name');
                    const domainSelect = dialog.querySelector('#email-domain');
                    const cancelBtn = dialog.querySelector('#cancel-btn');
                    const okBtn = dialog.querySelector('#ok-btn');

                    const close = () => {
                        try { overlay.remove(); } catch {}
                    };

                    const submit = () => {
                        const name = (nameInput.value || '').trim();
                        if (!name) return;

                        const email = name.includes('@') ? name : name + (domainSelect.value || '@outlook.com');
                        close();
                        resolve(email);
                    };

                    okBtn.onclick = submit;
                    cancelBtn.onclick = () => { close(); resolve(''); };

                    dialog.addEventListener('keydown', e => {
                        if (e.key === 'Enter') submit();
                        if (e.key === 'Escape') { close(); resolve(''); }
                    });

                    nameInput.focus();
                });
            },

            async token(tenant, code) {
                const oauthState = JSON.parse(localStorage.getItem('oauth_state') || '{}');
                const { verifier } = oauthState;
                if (!verifier) throw new Error('è®¤è¯çŠ¶æ€ä¸¢å¤±');

                const url = tenant.endsWith('/') ? `${tenant}token` : `${tenant}/token`;
                const response = await safeFetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        grant_type: 'authorization_code',
                        client_id: CFG.clientID,
                        code_verifier: verifier,
                        redirect_uri: '',
                        code
                    })
                });

                const result = await response.json();
                return result.access_token || (() => { throw new Error('è·å–ä»¤ç‰Œå¤±è´¥'); })();
            }
        };

        // ä½™é¢æ£€æŸ¥åŠŸèƒ½ï¼ˆå®Œæ•´å®ç°ï¼Œå¸¦CORSå¤„ç†ï¼‰
        const balance = {
            async getBanStatus(tenant, token) {
                if (!tenant || !token) return 'ERROR';
                const url = tenant.endsWith('/') ? `${tenant}api/v1/me` : `${tenant}/api/v1/me`;
                try {
                    const response = await safeFetch(url, {
                        method: 'GET',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Accept': 'application/json'
                        }
                    });
                    if (response.ok) return 'OK';
                    if (response.status === 404) return 'OK';
                    if (response.status === 403) return 'BANNED';
                    if (response.status === 402) return 'EXPIRED';
                    if (response.status === 401) return 'EXPIRED';
                    return 'ERROR';
                } catch (error) {
                    console.error('æ£€æŸ¥å°ç¦çŠ¶æ€å¤±è´¥:', error);
                    return 'ERROR';
                }
            },

            async info(token) {
                try {
                    // è·å–è®¢é˜…ä¿¡æ¯
                    const subResponse = await safeFetch(`${CFG.orbAPI}/subscriptions_from_link?token=${token}`, {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json'
                        }
                    });

                    if (!subResponse.ok) {
                        if (subResponse.status === 401) {
                            throw new Error('Tokenæ— æ•ˆæˆ–å·²è¿‡æœŸ');
                        }
                        throw new Error(`è®¢é˜…APIè¯·æ±‚å¤±è´¥: ${subResponse.status}`);
                    }

                    const sub = await subResponse.json();
                    const item = sub.data?.[0];
                    const customer = item?.customer;
                    if (!customer) throw new Error('è®¢é˜…ä¿¡æ¯é”™è¯¯');

                    // è·å–ä½™é¢ä¿¡æ¯
                    const balResponse = await safeFetch(`${CFG.orbAPI}/customers/${customer.id}/ledger_summary?pricing_unit_id=${CFG.pricingUnit}&token=${token}`, {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json'
                        }
                    });

                    if (!balResponse.ok) {
                        if (balResponse.status === 401) {
                            throw new Error('Tokenæ— æ•ˆæˆ–å·²è¿‡æœŸ');
                        }
                        throw new Error(`ä½™é¢APIè¯·æ±‚å¤±è´¥: ${balResponse.status}`);
                    }

                    const bal = await balResponse.json();

                    // {{ AURA-X: Modify - ä¿®å¤åŒ…å«é¢åº¦è·å–é€»è¾‘ï¼Œå®Œå…¨æŒ‰ç…§youhou.jsçš„é€»è¾‘. Approval: å¯¸æ­¢(ID:1735308000). }}
                    // è·å–åŒ…å«é¢åº¦ - å®Œå…¨æŒ‰ç…§youhou.jsçš„é€»è¾‘
                    let included;
                    try {
                        const pi = (item.price_intervals || []).find(x =>
                            x.allocation && x.allocation.pricing_unit?.id === CFG.pricingUnit
                        );
                        included = pi?.allocation?.amount;
                        console.log('æ‰¾åˆ°çš„allocation:', pi?.allocation, 'æ‰€æœ‰price_intervals:', item.price_intervals);
                    } catch (e) {
                        console.error('è·å–allocationå¤±è´¥:', e);
                    }

                    return {
                        email: customer.email,
                        balance: bal.credits_balance,
                        endDate: item.end_date,
                        included
                    };
                } catch (error) {
                    console.error('è·å–è®¢é˜…ä¿¡æ¯å¤±è´¥:', error);
                    throw error;
                }
            },
            

            async check(cred) {
                console.log(`å¼€å§‹æ£€æµ‹å‡­è¯: ${cred.email || cred.id}`);

                try {
                    // æ£€æŸ¥åŸºæœ¬ä¿¡æ¯
                    if (!cred.token && !cred.subToken) {
                        console.log('å‡­è¯ç¼ºå°‘tokenå’ŒsubToken');
                        const updatedCred = {
                            ...cred,
                            status: 'NO_TOKEN',
                            updatedAt: Date.now()
                        };
                        this.updateCredential(updatedCred);
                        return 'NO_TOKEN';
                    }

                    // æ£€æŸ¥å°ç¦çŠ¶æ€
                    if (cred.token && cred.tenant) {
                        console.log('æ£€æŸ¥å°ç¦çŠ¶æ€...');
                        const banStatus = await this.getBanStatus(cred.tenant, cred.token);
                        console.log(`å°ç¦çŠ¶æ€æ£€æŸ¥ç»“æœ: ${banStatus}`);

                        if (banStatus === 'BANNED' || banStatus === 'EXPIRED') {
                            const updatedCred = {
                                ...cred,
                                status: banStatus,
                                lastBalance: null,
                                lastIncluded: null,
                                updatedAt: Date.now()
                            };
                            this.updateCredential(updatedCred);
                            return banStatus;
                        }
                    }

                    // æ£€æŸ¥subToken
                    if (!cred.subToken) {
                        console.log('ç¼ºå°‘subToken');
                        const updatedCred = {
                            ...cred,
                            status: 'NO_TOKEN',
                            updatedAt: Date.now()
                        };
                        this.updateCredential(updatedCred);
                        return 'NO_TOKEN';
                    }

                    // è·å–è¯¦ç»†ä¿¡æ¯
                    console.log('è·å–è®¢é˜…ä¿¡æ¯...');
                    const info = await this.info(cred.subToken);
                    console.log('è®¢é˜…ä¿¡æ¯:', info);

                    const expired = info.endDate && Date.now() > new Date(info.endDate);
                    const status = expired ? 'EXPIRED' : (info.balance <= 0 ? 'NO_BALANCE' : 'ACTIVE');

                    console.log(`æœ€ç»ˆçŠ¶æ€: ${status}`);

                    const updatedCred = {
                        ...cred,
                        status,
                        lastBalance: info.balance,
                        lastEndDate: info.endDate,
                        lastIncluded: info.included,
                        updatedAt: Date.now()
                    };
                    this.updateCredential(updatedCred);
                    return status;

                } catch (error) {
                    console.error('æ£€æµ‹å‡­è¯å¤±è´¥:', error);

                    // æ ¹æ®é”™è¯¯ç±»å‹æä¾›æ›´è¯¦ç»†çš„çŠ¶æ€å’Œç”¨æˆ·æç¤º
                    let errorStatus = 'ERROR';
                    let errorMessage = error.message;
                    if (error.message.includes('Tokenæ— æ•ˆ')) {
                        errorStatus = 'NO_TOKEN';
                        errorMessage = 'Tokenæ— æ•ˆæˆ–å·²è¿‡æœŸ';
                    } else if (error.message.includes('CORS') || error.message.includes('Failed to fetch')) {
                        errorStatus = 'NETWORK_ERROR';
                        errorMessage = 'ç½‘ç»œè¿æ¥é—®é¢˜';

                        // æ˜¾ç¤ºè¯¦ç»†é”™è¯¯ä¿¡æ¯
                        showDetailedError(
                            'ç½‘ç»œè¿æ¥å¤±è´¥',
                            `æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨æ£€æµ‹å‡­è¯çŠ¶æ€ã€‚è¿™å¯èƒ½æ˜¯ç”±äºç½‘ç»œé—®é¢˜æˆ–CORSé™åˆ¶å¯¼è‡´çš„ã€‚`,
                            [
                                'ä½¿ç”¨ä»£ç†é‡è¯•',
                                'æ‰“å¼€ CORS è§£å†³æ–¹æ¡ˆ',
                                'æ£€æŸ¥ç½‘ç»œè¿æ¥',
                                'å°è¯•ä½¿ç”¨æµè§ˆå™¨æ‰©å±•è§£å†³CORSé—®é¢˜',
                                'ç¨åé‡è¯•'
                            ]
                        );
                    } else if (error.message.includes('è®¤è¯å¤±è´¥')) {
                        errorStatus = 'AUTH_ERROR';
                        errorMessage = 'è®¤è¯å¤±è´¥';
                    }

                    const updatedCred = {
                        ...cred,
                        status: errorStatus,
                        lastError: errorMessage,
                        updatedAt: Date.now()
                    };
                    this.updateCredential(updatedCred);
                    return errorStatus;
                }
            },

            updateCredential(updatedCred) {
                const creds = store.get();
                const index = creds.findIndex(c => c.id == updatedCred.id);
                if (index !== -1) {
                    creds[index] = updatedCred;
                    store.set(creds);
                }
            }
        };

        // å‡­è¯ç®¡ç†ç•Œé¢
        function showManageDialog() {
            const creds = store.get();

            // åˆ›å»ºæ¨¡æ€æ¡†
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed; inset: 0; background: rgba(0,0,0,.5); z-index: 9999;
                display: flex; align-items: center; justify-content: center;
            `;

            const dialog = document.createElement('div');
            dialog.style.cssText = `
                background: var(--bg); border-radius: 12px; padding: 20px;
                max-width: 800px; width: 90vw; max-height: 80vh; overflow-y: auto;
                box-shadow: 0 25px 60px -12px rgba(0,0,0,.28);
            `;

            dialog.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0; color: var(--fg);">ğŸ”‘ å‡­è¯ç®¡ç†</h2>
                    <button id="close-dialog" class="btn btn-ghost">âœ•</button>
                </div>
                <div style="margin-bottom: 15px;">
                    <button id="add-cred" class="btn btn-primary">â• æ·»åŠ å‡­è¯</button>
                    <button id="clear-all" class="btn btn-danger" style="margin-left: 10px;">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰</button>
                </div>
                <div id="creds-list">
                    ${creds.length === 0 ?
                        '<div style="text-align: center; color: var(--muted); padding: 40px;">æš‚æ— å‡­è¯æ•°æ®</div>' :
                        creds.map((cred, index) => `
                            <div style="border: 1px solid var(--bd); border-radius: 8px; padding: 15px; margin-bottom: 10px;">
                                <div style="display: flex; justify-content: space-between; align-items: center;">
                                    <div>
                                        <strong>${cred.email || 'æœªçŸ¥é‚®ç®±'}</strong>
                                        <div style="font-size: 12px; color: var(--muted);">
                                            ID: ${cred.id || 'N/A'} | çŠ¶æ€: ${cred.status || 'æœªçŸ¥'}
                                        </div>
                                    </div>
                                    <button class="btn btn-danger btn-sm" onclick="deleteCred(${index})">åˆ é™¤</button>
                                </div>
                            </div>
                        `).join('')
                    }
                </div>
            `;

            overlay.appendChild(dialog);
            document.body.appendChild(overlay);

            // ç»‘å®šäº‹ä»¶
            $('#close-dialog').onclick = () => overlay.remove();
            $('#add-cred').onclick = () => {
                const email = prompt('è¯·è¾“å…¥é‚®ç®±:');
                const tenant = prompt('è¯·è¾“å…¥ç§Ÿæˆ·URL:');
                if (email && tenant) {
                    const newCred = {
                        id: Date.now(),
                        email: email,
                        tenant: tenant,
                        status: 'NEW',
                        updatedAt: Date.now()
                    };
                    const creds = store.get();
                    creds.push(newCred);
                    store.set(creds);
                    showToast('å‡­è¯å·²æ·»åŠ ', 'success');
                    overlay.remove();
                    showManageDialog(); // é‡æ–°æ‰“å¼€
                }
            };
            $('#clear-all').onclick = () => {
                if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å‡­è¯å—ï¼Ÿ')) {
                    store.set([]);
                    showToast('æ‰€æœ‰å‡­è¯å·²æ¸…ç©º', 'success');
                    overlay.remove();
                }
            };

            overlay.onclick = (e) => {
                if (e.target === overlay) overlay.remove();
            };
        }

        // åˆ é™¤å‡­è¯
        window.deleteCred = function(index) {
            const creds = store.get();
            if (confirm(`ç¡®å®šè¦åˆ é™¤å‡­è¯ "${creds[index]?.email}" å—ï¼Ÿ`)) {
                creds.splice(index, 1);
                store.set(creds);
                showToast('å‡­è¯å·²åˆ é™¤', 'success');
                document.querySelector('.modal-overlay')?.remove();
                showManageDialog();
            }
        };
        
        // äº‘åŒæ­¥é…ç½®å¯¹è¯æ¡†
        function showSyncDialog() {
            const config = gistSync.getConfig();
            
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed; inset: 0; background: rgba(0,0,0,.5); z-index: 9999;
                display: flex; align-items: center; justify-content: center;
            `;

            const dialog = document.createElement('div');
            dialog.style.cssText = `
                background: var(--bg); border-radius: 12px; padding: 20px;
                max-width: 600px; width: 90vw; max-height: 80vh; overflow-y: auto;
                box-shadow: 0 25px 60px -12px rgba(0,0,0,.28);
            `;

            dialog.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0; color: var(--fg);">â˜ï¸ GitHub Gist äº‘åŒæ­¥</h2>
                    <button id="close-sync" class="btn btn-ghost">âœ•</button>
                </div>
                
                <div style="background: var(--panel); border: 1px solid var(--bd); border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                    <h4 style="margin: 0 0 10px 0; color: var(--fg);">ğŸ“‹ é…ç½®æ­¥éª¤</h4>
                    <ol style="margin: 0; padding-left: 20px; color: var(--muted); font-size: 14px; line-height: 1.6;">
                        <li>è®¿é—® <a href="https://github.com/settings/tokens" target="_blank" style="color: #3b82f6;">GitHub Settings â†’ Personal access tokens</a></li>
                        <li>ç‚¹å‡» "Generate new token (classic)"</li>
                        <li>æƒé™åªéœ€å‹¾é€‰ <strong>gist</strong> å³å¯</li>
                        <li>å¤åˆ¶ç”Ÿæˆçš„ Token å¹¶ç²˜è´´åˆ°ä¸‹æ–¹</li>
                        <li><strong>è·å– Gist ID çš„ä¸¤ç§æ–¹å¼ï¼š</strong>
                            <ul style="margin: 5px 0; padding-left: 15px;">
                                <li><strong>è‡ªåŠ¨è·å–ï¼š</strong>é¦–æ¬¡ä½¿ç”¨ç‚¹å‡»"ä¸Šä¼ åˆ°äº‘ç«¯"ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ç”Ÿæˆ Gist ID</li>
                                <li><strong>æ‰‹åŠ¨è·å–ï¼š</strong>è®¿é—® <a href="https://gist.github.com/" target="_blank" style="color: #3b82f6;">GitHub Gist</a>ï¼Œæ‰¾åˆ°æ‚¨çš„å‡­è¯æ–‡ä»¶ï¼ŒURLä¸­çš„å­—ç¬¦ä¸²å°±æ˜¯ Gist ID<br>
                                    <span style="font-family: monospace; background: var(--chip); padding: 2px 4px; border-radius: 3px; font-size: 12px;">
                                        https://gist.github.com/username/<strong style="color: #dc2626;">abc123def456</strong> â† è¿™éƒ¨åˆ†å°±æ˜¯ Gist ID
                                    </span>
                                </li>
                            </ul>
                        </li>
                        <li>å…¶ä»–è®¾å¤‡è¾“å…¥ç›¸åŒçš„ Token å’Œ Gist ID å³å¯åŒæ­¥æ•°æ®</li>
                    </ol>
                </div>
                
                <div style="display: grid; grid-template-columns: 120px 1fr; gap: 15px; align-items: center; margin-bottom: 20px;">
                    <label style="color: var(--fg); font-weight: 500;">GitHub Token:</label>
                    <input id="sync-token" type="password" placeholder="ghp_xxxxxxxxxxxxxxxxxxxx" value="${config.token}" style="
                        width: 100%; padding: 8px 12px; border: 1px solid var(--bd);
                        border-radius: 8px; background: var(--bg); color: var(--fg);
                        font-family: ui-monospace, monospace; font-size: 12px;
                    " />
                    
                    <label style="color: var(--fg); font-weight: 500;">Gist ID:</label>
                    <input id="sync-gist-id" placeholder="è‡ªåŠ¨ç”Ÿæˆæˆ–æ‰‹åŠ¨è¾“å…¥" value="${config.gistId}" style="
                        width: 100%; padding: 8px 12px; border: 1px solid var(--bd);
                        border-radius: 8px; background: var(--bg); color: var(--fg);
                        font-family: ui-monospace, monospace; font-size: 12px;
                    " />
                    
                    <label style="color: var(--fg); font-weight: 500;">è‡ªåŠ¨åŒæ­¥:</label>
                    <label style="display: flex; align-items: center; gap: 8px; color: var(--muted);">
                        <input id="sync-auto" type="checkbox" ${config.autoSync ? 'checked' : ''} />
                        æ•°æ®å˜æ›´æ—¶è‡ªåŠ¨ä¸Šä¼ åˆ°äº‘ç«¯
                    </label>
                </div>
                
                <div style="display: flex; gap: 10px; justify-content: center; margin-bottom: 15px;">
                    <button id="sync-upload" class="btn btn-primary">â¬†ï¸ ä¸Šä¼ åˆ°äº‘ç«¯</button>
                    <button id="sync-preview" class="btn btn-secondary">ğŸ‘ï¸ é¢„è§ˆäº‘ç«¯æ•°æ®</button>
                    <button id="sync-download" class="btn btn-secondary">â¬‡ï¸ ä»äº‘ç«¯ä¸‹è½½</button>
                    <button id="sync-test" class="btn btn-ghost">ğŸ§ª æµ‹è¯•è¿æ¥</button>
                </div>
                
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button id="sync-save" class="btn btn-primary">ğŸ’¾ ä¿å­˜é…ç½®</button>
                    <button id="sync-clear" class="btn btn-danger">ğŸ—‘ï¸ æ¸…é™¤é…ç½®</button>
                </div>
                
                <div id="sync-status" style="margin-top: 15px; padding: 10px; border-radius: 8px; display: none;"></div>
            `;

            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            
            const showStatus = (message, type = 'info') => {
                const statusDiv = $('#sync-status');
                const colors = {
                    success: { bg: '#dcfce7', text: '#166534', border: '#16a34a' },
                    error: { bg: '#fee2e2', text: '#991b1b', border: '#dc2626' },
                    info: { bg: '#dbeafe', text: '#1e40af', border: '#3b82f6' }
                };
                const color = colors[type] || colors.info;
                
                statusDiv.style.display = 'block';
                statusDiv.style.background = color.bg;
                statusDiv.style.color = color.text;
                statusDiv.style.border = `1px solid ${color.border}`;
                statusDiv.textContent = message;
            };

            // ç»‘å®šäº‹ä»¶
            $('#close-sync').onclick = () => overlay.remove();
            
            $('#sync-save').onclick = () => {
                const newConfig = {
                    token: $('#sync-token').value.trim(),
                    gistId: $('#sync-gist-id').value.trim(),
                    autoSync: $('#sync-auto').checked
                };
                
                if (gistSync.setConfig(newConfig)) {
                    showToast('é…ç½®å·²ä¿å­˜', 'success');
                    showStatus('é…ç½®å·²ä¿å­˜åˆ°æœ¬åœ°', 'success');
                } else {
                    showStatus('ä¿å­˜é…ç½®å¤±è´¥', 'error');
                }
            };
            
            $('#sync-clear').onclick = () => {
                if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰åŒæ­¥é…ç½®å—ï¼Ÿ')) {
                    gistSync.setConfig({ token: '', gistId: '', autoSync: false });
                    $('#sync-token').value = '';
                    $('#sync-gist-id').value = '';
                    $('#sync-auto').checked = false;
                    showStatus('é…ç½®å·²æ¸…é™¤', 'success');
                }
            };
            
            $('#sync-test').onclick = async () => {
                const token = $('#sync-token').value.trim();
                if (!token) {
                    showStatus('è¯·å…ˆè¾“å…¥ GitHub Token', 'error');
                    return;
                }
                
                showStatus('æ­£åœ¨æµ‹è¯•è¿æ¥...', 'info');
                
                try {
                    const response = await fetch('https://api.github.com/user', {
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    if (response.ok) {
                        const user = await response.json();
                        showStatus(`âœ… è¿æ¥æˆåŠŸï¼å½“å‰ç”¨æˆ·: ${user.login}`, 'success');
                    } else {
                        showStatus('âŒ Token æ— æ•ˆæˆ–æƒé™ä¸è¶³', 'error');
                    }
                } catch (error) {
                    showStatus(`âŒ è¿æ¥å¤±è´¥: ${error.message}`, 'error');
                }
            };
            
            $('#sync-upload').onclick = async () => {
                const token = $('#sync-token').value.trim();
                if (!token) {
                    showStatus('è¯·å…ˆè¾“å…¥ GitHub Token', 'error');
                    return;
                }
                
                showStatus('æ­£åœ¨ä¸Šä¼ åˆ°äº‘ç«¯...', 'info');
                
                try {
                    // å…ˆä¿å­˜é…ç½®
                    const newConfig = {
                        token: token,
                        gistId: $('#sync-gist-id').value.trim(),
                        autoSync: $('#sync-auto').checked
                    };
                    gistSync.setConfig(newConfig);
                    
                    const result = await gistSync.sync('upload');
                    $('#sync-gist-id').value = result.gistId;
                    
                    showStatus(`âœ… ä¸Šä¼ æˆåŠŸï¼å·²åŒæ­¥ ${result.count} ä¸ªå‡­è¯`, 'success');
                    showToast(`äº‘ç«¯åŒæ­¥æˆåŠŸï¼š${result.count} ä¸ªå‡­è¯`, 'success');
                } catch (error) {
                    showStatus(`âŒ ä¸Šä¼ å¤±è´¥: ${error.message}`, 'error');
                    showToast('äº‘ç«¯ä¸Šä¼ å¤±è´¥: ' + error.message, 'error');
                }
            };
            
            $('#sync-preview').onclick = async () => {
                const token = $('#sync-token').value.trim();
                const gistId = $('#sync-gist-id').value.trim();
                
                if (!token || !gistId) {
                    showStatus('è¯·å…ˆè¾“å…¥ GitHub Token å’Œ Gist ID', 'error');
                    return;
                }
                
                showStatus('æ­£åœ¨è·å–äº‘ç«¯æ•°æ®...', 'info');
                
                try {
                    const cloudData = await gistSync.download(token, gistId);
                    overlay.remove();
                    showCloudDataPreview(cloudData);
                } catch (error) {
                    showStatus(`âŒ è·å–å¤±è´¥: ${error.message}`, 'error');
                }
            };
            
            $('#sync-download').onclick = async () => {
                const token = $('#sync-token').value.trim();
                const gistId = $('#sync-gist-id').value.trim();
                
                if (!token || !gistId) {
                    showStatus('è¯·å…ˆè¾“å…¥ GitHub Token å’Œ Gist ID', 'error');
                    return;
                }
                
                if (!confirm('ä¸‹è½½å°†è¦†ç›–æœ¬åœ°æ•°æ®ï¼Œç¡®å®šç»§ç»­å—ï¼Ÿ')) {
                    return;
                }
                
                showStatus('æ­£åœ¨ä»äº‘ç«¯ä¸‹è½½...', 'info');
                
                try {
                    // å…ˆä¿å­˜é…ç½®
                    const newConfig = {
                        token: token,
                        gistId: gistId,
                        autoSync: $('#sync-auto').checked
                    };
                    gistSync.setConfig(newConfig);
                    
                    const result = await gistSync.sync('download');
                    
                    showStatus(`âœ… ä¸‹è½½æˆåŠŸï¼å·²åŒæ­¥ ${result.count} ä¸ªå‡­è¯`, 'success');
                    showToast(`äº‘ç«¯ä¸‹è½½æˆåŠŸï¼š${result.count} ä¸ªå‡­è¯`, 'success');
                    
                    // åˆ·æ–°ä¸»ç•Œé¢
                    setTimeout(() => {
                        overlay.remove();
                        showCredentialManagement();
                    }, 1500);
                } catch (error) {
                    showStatus(`âŒ ä¸‹è½½å¤±è´¥: ${error.message}`, 'error');
                    showToast('äº‘ç«¯ä¸‹è½½å¤±è´¥: ' + error.message, 'error');
                }
            };

            overlay.onclick = (e) => {
                if (e.target === overlay) overlay.remove();
            };
        }
        
        // äº‘ç«¯æ•°æ®é¢„è§ˆå¯¹è¯æ¡†
        function showCloudDataPreview(cloudData) {
            const { data, lastSync, version } = cloudData;
            const localData = store.get();
            
            // ç»Ÿè®¡ä¿¡æ¯
            const cloudStats = getCredentialStats(data);
            const localStats = getCredentialStats(localData);
            
            // æŒ‰çŠ¶æ€åˆ†ç»„
            const groupByStatus = (creds) => {
                const groups = {};
                creds.forEach(cred => {
                    const status = cred.status || 'UNKNOWN';
                    if (!groups[status]) groups[status] = [];
                    groups[status].push(cred);
                });
                return groups;
            };
            
            const cloudGroups = groupByStatus(data);
            const localGroups = groupByStatus(localData);
            
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed; inset: 0; background: rgba(0,0,0,.5); z-index: 9999;
                display: flex; align-items: center; justify-content: center;
            `;

            const dialog = document.createElement('div');
            dialog.style.cssText = `
                background: var(--bg); border-radius: 12px; padding: 20px;
                max-width: 900px; width: 95vw; max-height: 85vh; overflow-y: auto;
                box-shadow: 0 25px 60px -12px rgba(0,0,0,.28);
            `;

            // ç”ŸæˆçŠ¶æ€å¯¹æ¯”è¡¨æ ¼
            const statusComparison = Object.keys({...cloudGroups, ...localGroups}).map(status => {
                const cloudCount = cloudGroups[status]?.length || 0;
                const localCount = localGroups[status]?.length || 0;
                const statusText = getStatusText(status);
                const statusColor = getStatusColor(status);
                
                return `
                    <tr style="border-bottom: 1px solid var(--bd);">
                        <td style="padding: 8px; color: ${statusColor.text}; font-weight: 500;">${statusText}</td>
                        <td style="padding: 8px; text-align: center; color: var(--fg);">${localCount}</td>
                        <td style="padding: 8px; text-align: center; color: var(--fg);">${cloudCount}</td>
                        <td style="padding: 8px; text-align: center; color: ${cloudCount > localCount ? '#16a34a' : cloudCount < localCount ? '#dc2626' : 'var(--muted)'};">
                            ${cloudCount > localCount ? '+' + (cloudCount - localCount) : cloudCount < localCount ? (cloudCount - localCount) : '='}
                        </td>
                    </tr>
                `;
            }).join('');
            
            // ç”Ÿæˆäº‘ç«¯å‡­è¯åˆ—è¡¨é¢„è§ˆ
            const credentialPreview = data.slice(0, 10).map((cred, index) => {
                const statusColor = getStatusColor(cred.status);
                return `
                    <div style="
                        display: flex; justify-content: space-between; align-items: center;
                        padding: 8px 12px; margin: 4px 0; border-radius: 6px;
                        background: ${statusColor.bg}; border: 1px solid ${statusColor.border};
                    ">
                        <div>
                            <strong style="color: ${statusColor.text};">${cred.email || 'æœªçŸ¥é‚®ç®±'}</strong>
                            <div style="font-size: 11px; color: var(--muted);">
                                ID: ${cred.id} | æ›´æ–°: ${cred.updatedAt ? new Date(cred.updatedAt).toLocaleString() : 'æœªçŸ¥'}
                            </div>
                        </div>
                        <span style="
                            background: ${statusColor.text}; color: white;
                            padding: 2px 6px; border-radius: 4px; font-size: 10px; font-weight: bold;
                        ">${getStatusText(cred.status)}</span>
                    </div>
                `;
            }).join('');

            dialog.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0; color: var(--fg);">ğŸ‘ï¸ äº‘ç«¯æ•°æ®é¢„è§ˆ</h2>
                    <button id="close-preview" class="btn btn-ghost">âœ•</button>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <!-- åŒæ­¥ä¿¡æ¯ -->
                    <div style="background: var(--panel); border: 1px solid var(--bd); border-radius: 8px; padding: 15px;">
                        <h4 style="margin: 0 0 10px 0; color: var(--fg);">ğŸ“Š åŒæ­¥ä¿¡æ¯</h4>
                        <div style="color: var(--muted); font-size: 14px; line-height: 1.6;">
                            <div><strong>æœ€ååŒæ­¥:</strong> ${lastSync ? new Date(lastSync).toLocaleString() : 'æœªçŸ¥'}</div>
                            <div><strong>æ•°æ®ç‰ˆæœ¬:</strong> ${version || '1.0'}</div>
                            <div><strong>äº‘ç«¯å‡­è¯æ•°:</strong> ${data.length}</div>
                            <div><strong>æœ¬åœ°å‡­è¯æ•°:</strong> ${localData.length}</div>
                        </div>
                    </div>
                    
                    <!-- çŠ¶æ€å¯¹æ¯” -->
                    <div style="background: var(--panel); border: 1px solid var(--bd); border-radius: 8px; padding: 15px;">
                        <h4 style="margin: 0 0 10px 0; color: var(--fg);">ğŸ“ˆ çŠ¶æ€å¯¹æ¯”</h4>
                        <table style="width: 100%; font-size: 12px; border-collapse: collapse;">
                            <thead>
                                <tr style="background: var(--chip); color: var(--muted);">
                                    <th style="padding: 6px; text-align: left;">çŠ¶æ€</th>
                                    <th style="padding: 6px; text-align: center;">æœ¬åœ°</th>
                                    <th style="padding: 6px; text-align: center;">äº‘ç«¯</th>
                                    <th style="padding: 6px; text-align: center;">å·®å¼‚</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${statusComparison}
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- äº‘ç«¯å‡­è¯é¢„è§ˆ -->
                <div style="background: var(--panel); border: 1px solid var(--bd); border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                    <h4 style="margin: 0 0 10px 0; color: var(--fg);">ğŸ“‹ äº‘ç«¯å‡­è¯é¢„è§ˆ ${data.length > 10 ? `(æ˜¾ç¤ºå‰10ä¸ªï¼Œå…±${data.length}ä¸ª)` : `(å…±${data.length}ä¸ª)`}</h4>
                    <div style="max-height: 300px; overflow-y: auto;">
                        ${data.length > 0 ? credentialPreview : '<div style="text-align: center; color: var(--muted); padding: 20px;">äº‘ç«¯æš‚æ— å‡­è¯æ•°æ®</div>'}
                    </div>
                </div>
                
                <!-- æ“ä½œæŒ‰é’® -->
                <div style="display: flex; gap: 10px; justify-content: center;">
                    <button id="preview-download" class="btn btn-primary">â¬‡ï¸ ç¡®è®¤ä¸‹è½½å¹¶è¦†ç›–æœ¬åœ°</button>
                    <button id="preview-merge" class="btn btn-secondary">ğŸ”„ æ™ºèƒ½åˆå¹¶ï¼ˆæ¨èï¼‰</button>
                    <button id="preview-cancel" class="btn btn-ghost">âŒ å–æ¶ˆ</button>
                </div>
                
                <div style="background: var(--chip); border-radius: 6px; padding: 10px; margin-top: 15px; font-size: 12px; color: var(--muted);">
                    <strong>ğŸ’¡ æ“ä½œè¯´æ˜ï¼š</strong><br>
                    â€¢ <strong>ç¡®è®¤ä¸‹è½½ï¼š</strong>å®Œå…¨è¦†ç›–æœ¬åœ°æ•°æ®ï¼Œé€‚ç”¨äºå…¨æ–°è®¾å¤‡æˆ–å®Œå…¨åŒæ­¥<br>
                    â€¢ <strong>æ™ºèƒ½åˆå¹¶ï¼š</strong>ä¿ç•™æœ¬åœ°æ•°æ®ï¼Œä»…æ·»åŠ äº‘ç«¯æ–°å¢çš„å‡­è¯ï¼Œé¿å…æ•°æ®ä¸¢å¤±<br>
                    â€¢ <strong>å–æ¶ˆï¼š</strong>å…³é—­é¢„è§ˆï¼Œä¸è¿›è¡Œä»»ä½•æ“ä½œ
                </div>
            `;

            overlay.appendChild(dialog);
            document.body.appendChild(overlay);

            // ç»‘å®šäº‹ä»¶
            $('#close-preview').onclick = () => overlay.remove();
            $('#preview-cancel').onclick = () => overlay.remove();
            
            $('#preview-download').onclick = async () => {
                if (confirm(`ç¡®å®šè¦ç”¨äº‘ç«¯çš„ ${data.length} ä¸ªå‡­è¯å®Œå…¨è¦†ç›–æœ¬åœ°çš„ ${localData.length} ä¸ªå‡­è¯å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼`)) {
                    try {
                        store.set(data);
                        showToast(`âœ… ä¸‹è½½å®Œæˆï¼å·²åŒæ­¥ ${data.length} ä¸ªå‡­è¯`, 'success');
                        overlay.remove();
                        showCredentialManagement();
                    } catch (error) {
                        showToast('âŒ ä¸‹è½½å¤±è´¥: ' + error.message, 'error');
                    }
                }
            };
            
            $('#preview-merge').onclick = async () => {
                try {
                    // æ™ºèƒ½åˆå¹¶ï¼šä»¥IDä¸ºå‡†ï¼Œäº‘ç«¯æ•°æ®ä¼˜å…ˆï¼Œä½†ä¿ç•™æœ¬åœ°ç‹¬æœ‰çš„æ•°æ®
                    const mergedData = [...localData];
                    const localIds = new Set(localData.map(c => c.id));
                    
                    let addedCount = 0;
                    let updatedCount = 0;
                    
                    data.forEach(cloudCred => {
                        const existingIndex = mergedData.findIndex(c => c.id === cloudCred.id);
                        if (existingIndex >= 0) {
                            // æ›´æ–°ç°æœ‰å‡­è¯ï¼ˆäº‘ç«¯æ•°æ®æ›´æ–°æ—¶é—´æ›´æ–°åˆ™è¦†ç›–ï¼‰
                            if ((cloudCred.updatedAt || 0) >= (mergedData[existingIndex].updatedAt || 0)) {
                                mergedData[existingIndex] = cloudCred;
                                updatedCount++;
                            }
                        } else {
                            // æ·»åŠ æ–°å‡­è¯
                            mergedData.push(cloudCred);
                            addedCount++;
                        }
                    });
                    
                    store.set(mergedData);
                    showToast(`âœ… æ™ºèƒ½åˆå¹¶å®Œæˆï¼æ–°å¢ ${addedCount} ä¸ªï¼Œæ›´æ–° ${updatedCount} ä¸ªå‡­è¯`, 'success');
                    overlay.remove();
                    showCredentialManagement();
                } catch (error) {
                    showToast('âŒ åˆå¹¶å¤±è´¥: ' + error.message, 'error');
                }
            };

            overlay.onclick = (e) => {
                if (e.target === overlay) overlay.remove();
            };
        }

        // å…ˆå£°æ˜actionså¯¹è±¡ï¼Œç¨åèµ‹å€¼
        const actions = {};

        // å¯¼å…¥å¯¹è¯æ¡†
        function showImportDialog() {
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed; inset: 0; background: rgba(0,0,0,.5); z-index: 9999;
                display: flex; align-items: center; justify-content: center;
            `;

            const dialog = document.createElement('div');
            dialog.style.cssText = `
                background: var(--bg); border-radius: 12px; padding: 20px;
                max-width: 900px; width: 92vw; max-height: 84vh; overflow:auto;
                box-shadow: 0 25px 60px -12px rgba(0,0,0,.28);
            `;

            dialog.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                    <h2 style="margin: 0; color: var(--fg);">ğŸ“¥ å¯¼å…¥æ•°æ®</h2>
                    <button id="close-import" class="btn btn-ghost">âœ•</button>
                </div>

                <div style="display:flex; gap:8px; border-bottom:1px solid var(--bd); padding-bottom:8px; margin-bottom:10px;">
                    <button id="tab-paste"  class="btn btn-secondary btn-sm">ç²˜è´´å¯¼å…¥(JSON/JSONL/CSV)</button>
                    <button id="tab-manual" class="btn btn-ghost btn-sm">æ‰‹åŠ¨å¡«å†™å¯¼å…¥(å¯é€‰å¡«)</button>
                </div>

                <div id="panel-paste" style="display:block;">
                    <div style="margin-bottom: 10px; color: var(--muted);">æ”¯æŒæ ¼å¼ï¼šJSONæ•°ç»„ã€JSONLï¼ˆæ¯è¡Œä¸€ä¸ªJSONå¯¹è±¡ï¼‰ã€CSV</div>
                    <div style="display: flex; gap: 10px; margin-bottom: 10px; flex-wrap:wrap;">
                        <select id="dedup-mode" class="btn btn-ghost" style="padding: 6px 10px;">
                            <option value="fullEmail">å»é‡ï¼šå®Œæ•´é‚®ç®±</option>
                            <option value="nameKey">å»é‡ï¼šé‚®ç®±æœ¬åœ°å</option>
                            <option value="subToken">å»é‡ï¼šsubToken</option>
                        </select>
                        <select id="merge-mode" class="btn btn-ghost" style="padding: 6px 10px;">
                            <option value="overwrite">åˆå¹¶ï¼šè¦†ç›–å…¨éƒ¨å­—æ®µ</option>
                            <option value="onlyEmpty">åˆå¹¶ï¼šä»…ç©ºå­—æ®µ</option>
                            <option value="newer">åˆå¹¶ï¼šæ—¶é—´è¾ƒæ–°</option>
                        </select>
                    </div>
                    <textarea id="import-text" placeholder="è¯·ç²˜è´´è¦å¯¼å…¥çš„æ•°æ®..." style="
                        width: 100%; height: 300px; padding: 10px; border: 1px solid var(--bd);
                        border-radius: 8px; background: var(--panel); color: var(--fg);
                        font-family: ui-monospace, monospace; font-size: 12px; resize: vertical;
                    "></textarea>
                    <div id="import-error" style="color: #dc2626; font-size: 12px; margin-top: 5px; display: none;"></div>
                    <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 12px;">
                        <button id="preview-import" class="btn btn-secondary">é¢„è§ˆåˆå¹¶</button>
                        <button id="do-import" class="btn btn-primary">ç›´æ¥å¯¼å…¥</button>
                    </div>
                </div>

                <div id="panel-manual" style="display:none;">
                    <div style="display:grid; grid-template-columns:120px 1fr; gap:10px; align-items:center;">
                        <label>Email</label>
                        <input id="mi-email" placeholder="å¯ç•™ç©ºï¼Œä¾‹å¦‚ a@example.com" style="width:100%; padding:8px 10px; border:1px solid var(--bd); border-radius:8px; background:var(--bg); color:var(--fg);" />
                        <label>Tenant</label>
                        <input id="mi-tenant" placeholder="å¯ç•™ç©ºï¼Œä¾‹å¦‚ https://app.augmentcode.com/" style="width:100%; padding:8px 10px; border:1px solid var(--bd); border-radius:8px; background:var(--bg); color:var(--fg);" />
                        <label>Token</label>
                        <input id="mi-token" placeholder="å¯ç•™ç©ºï¼ŒAPI/è®¿é—®ä»¤ç‰Œ" style="width:100%; padding:8px 10px; border:1px solid var(--bd); border-radius:8px; background:var(--bg); color:var(--fg);" />
                        <label>subToken</label>
                        <input id="mi-sub" placeholder="å¯ç•™ç©ºï¼ŒOrbè®¢é˜…token" style="width:100%; padding:8px 10px; border:1px solid var(--bd); border-radius:8px; background:var(--bg); color:var(--fg);" />
                    </div>
                    <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:12px;">
                        <button id="mi-add" class="btn btn-secondary">æ·»åŠ ä¸€æ¡å¹¶ç»§ç»­</button>
                        <button id="mi-done" class="btn btn-primary">æ·»åŠ å¹¶å®Œæˆ</button>
                    </div>
                    <div id="mi-msg" style="margin-top:6px; font-size:12px; color:#166534;"></div>
                </div>
            `;

            overlay.appendChild(dialog);
            document.body.appendChild(overlay);

            // Tab åˆ‡æ¢
            const tabPaste = document.getElementById('tab-paste');
            const tabManual = document.getElementById('tab-manual');
            const panelPaste = document.getElementById('panel-paste');
            const panelManual = document.getElementById('panel-manual');
            function setTab(which){
                const isPaste = which === 'paste';
                panelPaste.style.display = isPaste ? 'block' : 'none';
                panelManual.style.display = isPaste ? 'none' : 'block';
                tabPaste.className = 'btn ' + (isPaste ? 'btn-secondary' : 'btn-ghost') + ' btn-sm';
                tabManual.className = 'btn ' + (isPaste ? 'btn-ghost' : 'btn-secondary') + ' btn-sm';
            }
            tabPaste.onclick = () => setTab('paste');
            tabManual.onclick = () => setTab('manual');

            // å…³é—­
            $('#close-import').onclick = () => overlay.remove();
            overlay.onclick = (e) => { if (e.target === overlay) overlay.remove(); };

            // ç²˜è´´å¯¼å…¥ è§£æä¸å¯¼å…¥
            $('#do-import').onclick = () => doImport(false);
            $('#preview-import').onclick = () => doImport(true);
            const INVALID_STATUSES = new Set(['EXPIRED','NO_BALANCE','ERROR','NETWORK_ERROR','AUTH_ERROR','BANNED']);
            function sectionNameForStatus(st){
                if (st === 'ACTIVE') return 'âœ… æ­£å¸¸å‡­è¯';
                return INVALID_STATUSES.has(st) ? 'âŒ å¤±æ•ˆå‡­è¯' : 'âš ï¸ å…¶ä»–å‡­è¯';
            }
            function normalizeItems(items){
                const baseTime = Date.now();
                return (Array.isArray(items) ? items : []).map((it, idx) => {
                    const o = typeof it === 'object' && it !== null ? { ...it } : {};
                    if (o.id == null) o.id = baseTime + idx;
                    if (o.updatedAt == null) o.updatedAt = now();
                    if (!o.status) o.status = o.subToken ? 'UNKNOWN' : 'NO_TOKEN';
                    return o;
                });
            }
            function doImport(preview = false) {
                const text = $('#import-text').value.trim();
                const errorDiv = $('#import-error');
                errorDiv.style.display = 'none';

                if (!text) {
                    errorDiv.textContent = 'è¯·è¾“å…¥è¦å¯¼å…¥çš„æ•°æ®';
                    errorDiv.style.display = 'block';
                    return;
                }

                try {
                    let data = [];
                    if (text.startsWith('[')) {
                        data = JSON.parse(text);
                    } else if (text.includes('\n') && text.split('\n').every(line => !line.trim() || line.trim().startsWith('{'))) {
                        data = text.split('\n').filter(line => line.trim()).map(line => JSON.parse(line));
                    } else {
                        data = parseCSV(text);
                    }
                    if (!Array.isArray(data)) throw new Error('æ•°æ®æ ¼å¼é”™è¯¯ï¼Œéœ€è¦æ•°ç»„æ ¼å¼');

                    const normalized = normalizeItems(data);
                    if (preview) {
                        showImportPreview(normalized);
                    } else {
                        const currentCreds = store.get();
                        const mergedData = [...currentCreds, ...normalized];
                        store.set(mergedData);
                        const counts = normalized.reduce((acc, item) => {
                            if (item.status === 'ACTIVE') acc.active++;
                            else if (INVALID_STATUSES.has(item.status)) acc.invalid++;
                            else acc.other++;
                            return acc;
                        }, {active:0, invalid:0, other:0});
                        overlay.remove();
                        showCredentialManagement();
                        window.scrollTo(0,0);
                        showToast(`æˆåŠŸå¯¼å…¥ ${normalized.length} ä¸ªå‡­è¯ã€‚ä½ç½®ï¼šâœ… æ­£å¸¸ ${counts.active}ã€âŒ å¤±æ•ˆ ${counts.invalid}ã€âš ï¸ å…¶ä»– ${counts.other}ã€‚`, 'success');
                    }
                } catch (error) {
                    errorDiv.textContent = 'è§£æå¤±è´¥: ' + (error?.message || String(error));
                    errorDiv.style.display = 'block';
                }
            }

            // æ‰‹åŠ¨å¡«å†™ æ·»åŠ é€»è¾‘
            function collectManual(){
                const email  = (document.getElementById('mi-email').value || '').trim();
                const tenant = (document.getElementById('mi-tenant').value || '').trim();
                const token  = (document.getElementById('mi-token').value || '').trim();
                const sub    = (document.getElementById('mi-sub').value || '').trim();
                if (!email && !tenant && !token && !sub) return null; // è‡³å°‘å¡«ä¸€é¡¹
                const base = { email, tenant, token, subToken: sub };
                base.status = sub ? 'UNKNOWN' : 'NO_TOKEN';
                base.id = Date.now();
                base.updatedAt = now();
                return base;
            }
            function clearManual(){
                document.getElementById('mi-email').value = '';
                document.getElementById('mi-tenant').value = '';
                document.getElementById('mi-token').value = '';
                document.getElementById('mi-sub').value = '';
            }
            function addOnce(showMsg = true){
                const data = collectManual();
                const msgEl = document.getElementById('mi-msg');
                if (!data){
                    showToast('è¯·è‡³å°‘å¡«å†™ä¸€é¡¹', 'warning');
                    return null;
                }
                const list = store.get();
                list.push(data);
                store.set(list);
                const sectionName = sectionNameForStatus(data.status);
                if (showMsg) {
                    msgEl.textContent = `å·²æ·»åŠ åˆ°ï¼š${sectionName}ã€‚æ‚¨å¯ç»§ç»­å¡«å†™ä¸‹ä¸€æ¡â€¦`;
                    setTimeout(() => { msgEl.textContent = ''; }, 1500);
                }
                clearManual();
                showCredentialManagement();
                return data;
            }
            const miAddBtn = document.getElementById('mi-add');
            const miDoneBtn = document.getElementById('mi-done');
            if (miAddBtn)  miAddBtn.onclick  = () => addOnce(true);
            if (miDoneBtn) miDoneBtn.onclick = () => {
                const added = addOnce(false);
                if (added) {
                    overlay.remove();
                    window.scrollTo(0,0);
                    showToast(`å·²æ·»åŠ  1 æ¡ã€‚ä½ç½®ï¼š${sectionNameForStatus(added.status)}ã€‚`, 'success');
                }
            };
        }

        // å¯¼å‡ºå¯¹è¯æ¡†
        function showExportDialog() {
            const creds = store.get();
            const dataStr = JSON.stringify(creds, null, 2);

            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed; inset: 0; background: rgba(0,0,0,.5); z-index: 9999;
                display: flex; align-items: center; justify-content: center;
            `;

            const dialog = document.createElement('div');
            dialog.style.cssText = `
                background: var(--bg); border-radius: 12px; padding: 20px;
                max-width: 800px; width: 90vw; max-height: 80vh;
                box-shadow: 0 25px 60px -12px rgba(0,0,0,.28);
            `;

            dialog.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0; color: var(--fg);">ğŸ“¤ å¯¼å‡ºæ•°æ®</h2>
                    <button id="close-export" class="btn btn-ghost">âœ•</button>
                </div>
                <div style="margin-bottom: 15px;">
                    <p style="color: var(--muted); margin: 0 0 10px 0;">å…± ${creds.length} ä¸ªå‡­è¯ - å¯ç¼–è¾‘åä¿å­˜æ›´æ”¹</p>
                    <div style="display: flex; gap: 10px;">
                        <button id="copy-data" class="btn btn-secondary">ğŸ“‹ å¤åˆ¶åˆ°å‰ªè´´æ¿</button>
                        <button id="save-changes" class="btn btn-primary">ğŸ’¾ ä¿å­˜æ›´æ”¹</button>
                    </div>
                </div>
                <textarea id="export-text" style="
                    width: 100%; height: 400px; padding: 10px; border: 1px solid var(--bd);
                    border-radius: 8px; background: var(--panel); color: var(--fg);
                    font-family: ui-monospace, monospace; font-size: 12px; resize: vertical;
                ">${dataStr}</textarea>
                <div id="export-status" style="font-size: 12px; margin-top: 5px; display: none;"></div>
            `;

            overlay.appendChild(dialog);
            document.body.appendChild(overlay);

            // ç»‘å®šäº‹ä»¶
            $('#close-export').onclick = () => overlay.remove();
            $('#copy-data').onclick = () => {
                const textarea = $('#export-text');
                textarea.select();
                navigator.clipboard?.writeText(textarea.value);
                showToast('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');

                const btn = $('#copy-data');
                const originalText = btn.textContent;
                btn.textContent = 'âœ… å·²å¤åˆ¶';
                setTimeout(() => {
                    btn.textContent = originalText;
                }, 1000);
            };

            $('#save-changes').onclick = () => {
                try {
                    const newData = JSON.parse($('#export-text').value);
                    if (Array.isArray(newData)) {
                        store.set(newData);
                        showToast('æ›´æ”¹å·²ä¿å­˜', 'success');
                        overlay.remove();
                    } else {
                        throw new Error('æ•°æ®æ ¼å¼é”™è¯¯');
                    }
                } catch (error) {
                    const statusDiv = $('#export-status');
                    statusDiv.textContent = 'ä¿å­˜å¤±è´¥: ' + error.message;
                    statusDiv.style.color = '#dc2626';
                    statusDiv.style.display = 'block';
                }
            };

            overlay.onclick = (e) => {
                if (e.target === overlay) overlay.remove();
            };

            // è‡ªåŠ¨é€‰ä¸­æ–‡æœ¬
            setTimeout(() => {
                $('#export-text').focus();
            }, 100);
        }

        // CSVè§£æå‡½æ•°
        function parseCSV(text) {
            const lines = text.replace(/\r/g, '').split('\n').filter(Boolean);
            if (!lines.length) return [];

            const headers = splitCSVLine(lines[0]);
            return lines.slice(1).map(line => {
                const values = splitCSVLine(line);
                const obj = {};
                headers.forEach((header, index) => {
                    obj[header.trim()] = values[index] || '';
                });
                return obj;
            });
        }

        function splitCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;

            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                if (char === '"') {
                    if (inQuotes && line[i + 1] === '"') {
                        current += '"';
                        i++;
                    } else {
                        inQuotes = !inQuotes;
                    }
                } else if (char === ',' && !inQuotes) {
                    result.push(current);
                    current = '';
                } else {
                    current += char;
                }
            }
            result.push(current);
            return result.map(s => s.trim());
        }

        // å¯¼å…¥é¢„è§ˆåŠŸèƒ½
        function showImportPreview(data) {
            const INVALID_STATUSES = new Set(['EXPIRED','NO_BALANCE','ERROR','NETWORK_ERROR','AUTH_ERROR','BANNED']);
            const baseTime = Date.now();
            const normalized = (Array.isArray(data) ? data : []).map((it, idx) => {
                const o = typeof it === 'object' && it !== null ? { ...it } : {};
                if (o.id == null) o.id = baseTime + idx;
                if (o.updatedAt == null) o.updatedAt = now();
                if (!o.status) o.status = o.subToken ? 'UNKNOWN' : 'NO_TOKEN';
                return o;
            });

            const currentCreds = store.get();
            store.set([...currentCreds, ...normalized]);

            const counts = normalized.reduce((acc, item) => {
                if (item.status === 'ACTIVE') acc.active++;
                else if (INVALID_STATUSES.has(item.status)) acc.invalid++;
                else acc.other++;
                return acc;
            }, {active:0, invalid:0, other:0});

            // å…³é—­å¼¹å±‚ã€åˆ·æ–°ä¸»ç•Œé¢å¹¶æç¤ºå½’å±ä½ç½®
            document.querySelector('[style*="position: fixed"]')?.remove();
            showCredentialManagement();
            window.scrollTo(0,0);
            showToast(`æˆåŠŸå¯¼å…¥ ${normalized.length} ä¸ªå‡­è¯ã€‚ä½ç½®ï¼šâœ… æ­£å¸¸ ${counts.active}ã€âŒ å¤±æ•ˆ ${counts.invalid}ã€âš ï¸ å…¶ä»– ${counts.other}ã€‚`, 'success');
        }

        // â€”â€” ä»£ç†é…ç½®ç®¡ç†å¼¹çª— â€”â€”
        function showProxyManagerDialog() {
            const cloneDeep = (x) => JSON.parse(JSON.stringify(x));
            const initialList = (window.SmartCORSProxy?.getEffectiveProxies?.() || window.CORSProxyConfig?.proxies || []).map(p => ({
                name: p.name || '',
                url: p.url || p.base || '',
                reliable: !!p.reliable,
                rateLimit: p.rateLimit || '',
                supportsMethods: Array.isArray(p.supportsMethods) ? p.supportsMethods.slice() : ['GET'],
                supportsHeaders: p.supportsHeaders !== false
            }));
            let list = cloneDeep(initialList);

            const overlay = document.createElement('div');
            overlay.style.cssText = `position: fixed; inset: 0; background: rgba(0,0,0,.5); z-index: 9999; display: flex; align-items: center; justify-content: center;`;

            const dialog = document.createElement('div');
            dialog.style.cssText = `background: var(--bg); color: var(--fg); border-radius: 14px; padding: 18px; width: 80vw; height: 80vh; overflow: auto; box-shadow: 0 25px 60px -12px rgba(0,0,0,.35);`;

            const rowStyle = `display:grid;grid-template-columns:28px 1fr 2fr 120px 160px 140px 120px;gap:8px;align-items:center;padding:8px;border:1px solid var(--bd);border-radius:8px;background:var(--panel);`;

            function render() {
                dialog.innerHTML = `
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                        <h2 style="margin:0;">ğŸŒ ä»£ç†é…ç½®</h2>
                        <button id="proxy-close" class="btn btn-ghost">âœ•</button>
                    </div>
                    <div style="color:var(--muted);font-size:13px;margin-bottom:10px;">
                        é…ç½®å…¬å…±/è‡ªå»º CORS ä»£ç†ï¼Œè°ƒæ•´é¡ºåºå³ä¸ºå°è¯•é¡ºåºã€‚å¯è¿è¡Œè‡ªæ£€ä»¥è¯„ä¼°â€œè¿é€šæ€§/è½¬å‘å¤´/POSTâ€èƒ½åŠ›ã€‚
                    </div>
                    <div style="background: var(--panel); border: 1px solid var(--bd); border-radius: 8px; padding: 10px; margin-bottom: 10px; font-size: 12px; line-height: 1.6;">
                        <strong>è¯´æ˜ï¼š</strong>
                        <ul style="margin: 8px 0 0 18px; padding: 0;">
                            <li><strong>å¯é æ€§</strong>ï¼šè¿™æ˜¯ä½ å¯¹è¯¥ä»£ç†çš„ä¸»è§‚â€œå¯ä¿¡åº¦/ç¨³å®šæ€§â€æ ‡è®°ï¼Œç”¨äºæ’åºä¸ä¼˜å…ˆå°è¯•ï¼›ä¸ä»£è¡¨å®æ—¶å¯ç”¨æ€§ã€‚</li>
                            <li><strong>æ–¹æ³•(GET/POST)</strong>ï¼šå£°æ˜è¯¥ä»£ç†ç†è®ºä¸Šæ”¯æŒçš„è¯·æ±‚æ–¹æ³•ã€‚æœªå‹¾é€‰ POST æ—¶ï¼Œè¯¥ä»£ç†ä¸ä¼šè¢«ç”¨äº POST è¯·æ±‚çš„å€™é€‰ã€‚</li>
                            <li><strong>è½¬å‘è‡ªå®šä¹‰å¤´</strong>ï¼šå£°æ˜è¯¥ä»£ç†ç†è®ºä¸Šå¯è½¬å‘å¦‚ Authorization ç­‰è‡ªå®šä¹‰è¯·æ±‚å¤´ã€‚å®é™…æ•ˆæœå¯èƒ½å› æµè§ˆå™¨é¢„æ£€è€Œå—é™ï¼Œè¯·ç»“åˆâ€œğŸ§ª è‡ªæ£€â€ç»“æœåˆ¤å®šã€‚</li>
                        </ul>
                        <div style="color: var(--muted); margin-top: 6px;">
                            æ³¨ï¼šAllOrigins/ThingProxy é€šå¸¸ä¸è½¬å‘è‡ªå®šä¹‰å¤´ï¼›CORS Anywhere å¯èƒ½éœ€è¦å…ˆæ¿€æ´»ï¼›è‡ªå»º/Vercel å‡½æ•°ä»£ç†ä¸€èˆ¬å¯è½¬å‘å¤´ä¸”æ”¯æŒ POSTã€‚
                        </div>
                    </div>
                    <div style="display:grid;grid-template-columns:28px 1fr 2fr 120px 160px 140px 120px;gap:8px;margin:6px 0 8px 0;color:var(--muted);font-size:12px;">
                        <div>#</div>
                        <div>åç§°</div>
                        <div>åŸºå€</div>
                        <div>å¯é æ€§</div>
                        <div>æ–¹æ³•(GET/POST)</div>
                        <div>è½¬å‘è‡ªå®šä¹‰å¤´</div>
                        <div>æ’åº</div>
                    </div>
                    <div id="proxy-list" style="display:flex;flex-direction:column;gap:8px;"></div>
                    <div style="display:flex;gap:8px;margin:10px 0 6px 0;">
                        <button id="proxy-add" class="btn btn-secondary">â• æ·»åŠ ä»£ç†</button>
                        <button id="proxy-reset" class="btn btn-ghost">â†©ï¸ é‡ç½®ä¸ºé»˜è®¤</button>
                        <div style="margin-left:auto;display:flex;gap:8px;">
                            <button id="proxy-save" class="btn btn-primary">ğŸ’¾ ä¿å­˜å¹¶é‡æ–°æ£€æµ‹</button>
                            <button id="proxy-probe" class="btn btn-secondary">ğŸ§ª è¿è¡Œè‡ªæ£€</button>
                            <button id="proxy-toggle-json" class="btn btn-ghost">ğŸ§¾ æ˜¾ç¤ºJSON</button>
                            <button id="proxy-copy" class="btn btn-ghost">ğŸ“‹ å¤åˆ¶ç»“æœ</button>
                        </div>
                    </div>
                    <div id="proxy-summary" style="display:none;margin:8px 0 6px 0;"></div>
                    <div id="proxy-report" style="display:none;border:1px solid var(--bd);border-radius:10px;overflow:hidden;"></div>
                    <pre id="proxy-result" style="display:none;background:#0b1220;color:#e5eefc;border-radius:10px;padding:12px;max-height:220px;overflow:auto;font-size:12px;">(æ— )</pre>
                `;

                const listEl = dialog.querySelector('#proxy-list');

                listEl.innerHTML = '';
                list.forEach((p, idx) => {
                    const row = document.createElement('div');
                    row.style.cssText = rowStyle;
                    row.innerHTML = `
                        <div style="text-align:center;color:var(--muted);">${idx + 1}</div>
                        <input data-k="name" value="${p.name || ''}" placeholder="åç§°" style="padding:8px;border:1px solid var(--bd);border-radius:8px;background:var(--bg);color:var(--fg);"/>
                        <input data-k="url" value="${p.url || ''}" placeholder="https://example.com/?url=" style="padding:8px;border:1px solid var(--bd);border-radius:8px;background:var(--bg);color:var(--fg);"/>
                        <label style="display:flex;align-items:center;gap:6px;font-size:12px;color:var(--fg);"><input data-k="reliable" type="checkbox" ${p.reliable ? 'checked' : ''}/> å¯é </label>
                        <label style="display:flex;align-items:center;gap:6px;font-size:12px;color:var(--fg);"><input data-k="mGET" type="checkbox" ${p.supportsMethods?.includes('GET') ? 'checked' : ''}/> GET <input data-k="mPOST" type="checkbox" style="margin-left:10px;" ${p.supportsMethods?.includes('POST') ? 'checked' : ''}/> POST</label>
                        <label style="display:flex;align-items:center;gap:6px;font-size:12px;color:var(--fg);"><input data-k="supportsHeaders" type="checkbox" ${p.supportsHeaders ? 'checked' : ''}/> å¯è½¬å‘å¤´</label>
                        <div style="display:flex;gap:6px;justify-content:flex-end;">
                            <button class="btn btn-ghost btn-sm" data-action="up" title="ä¸Šç§»">â¬†ï¸</button>
                            <button class="btn btn-ghost btn-sm" data-action="down" title="ä¸‹ç§»">â¬‡ï¸</button>
                            <button class="btn btn-danger btn-sm" data-action="del" title="åˆ é™¤">ğŸ—‘ï¸</button>
                        </div>
                    `;

                    // input bindings
                    row.querySelectorAll('input').forEach(inp => {
                        inp.onchange = (e) => {
                            const k = inp.dataset.k;
                            if (k === 'name') list[idx].name = inp.value;
                            if (k === 'url') list[idx].url = inp.value;
                            if (k === 'reliable') list[idx].reliable = inp.checked;
                            if (k === 'supportsHeaders') list[idx].supportsHeaders = inp.checked;
                            if (k === 'mGET' || k === 'mPOST') {
                                const hasGet = row.querySelector('[data-k="mGET"]').checked;
                                const hasPost = row.querySelector('[data-k="mPOST"]').checked;
                                const methods = [];
                                if (hasGet) methods.push('GET');
                                if (hasPost) methods.push('POST');
                                list[idx].supportsMethods = methods.length ? methods : ['GET'];
                            }
                        };
                    });

                    // actions
                    row.querySelectorAll('button').forEach(btn => {
                        btn.onclick = () => {
                            const act = btn.dataset.action;
                            if (act === 'up' && idx > 0) {
                                [list[idx - 1], list[idx]] = [list[idx], list[idx - 1]];
                                render();
                            } else if (act === 'down' && idx < list.length - 1) {
                                [list[idx + 1], list[idx]] = [list[idx], list[idx + 1]];
                                render();
                            } else if (act === 'del') {
                                list.splice(idx, 1);
                                render();
                            }
                        };
                    });

                    listEl.appendChild(row);
                });

                // toolbar buttons
                dialog.querySelector('#proxy-close').onclick = () => overlay.remove();
                dialog.querySelector('#proxy-add').onclick = () => { list.push({ name: '', url: '', reliable: false, rateLimit: '', supportsMethods: ['GET'], supportsHeaders: true }); render(); };
                dialog.querySelector('#proxy-reset').onclick = async () => {
                    try {
                        window.SmartCORSProxy?.resetProxies?.();
                        list = cloneDeep(window.SmartCORSProxy?.getEffectiveProxies?.() || window.CORSProxyConfig?.proxies || []);
                        render();
                        showToast('å·²é‡ç½®ä¸ºé»˜è®¤ä»£ç†åˆ—è¡¨', 'success');
                    } catch (e) {
                        showToast('é‡ç½®å¤±è´¥: ' + (e?.message || e), 'error');
                    }
                };
                dialog.querySelector('#proxy-save').onclick = async () => {
                    try {
                        const sanitized = list.filter(p => (p.url || '').trim());
                        window.SmartCORSProxy?.setUserProxies?.(sanitized);
                        const ok = await window.SmartCORSProxy?.init?.();
                        const st = window.SmartCORSProxy?.getStatus?.() || {};
                        showToast(`ä»£ç†åˆ—è¡¨å·²ä¿å­˜å¹¶æ£€æµ‹ï¼šå¯ç”¨ ${st.workingCount || 0} ä¸ªï¼Œå½“å‰ ${st.currentProxy || 'None'}`, ok ? 'success' : 'warning');
                    } catch (e) {
                        showToast('ä¿å­˜å¤±è´¥: ' + (e?.message || e), 'error');
                    }
                };
                dialog.querySelector('#proxy-probe').onclick = async () => {
                    const btn = dialog.querySelector('#proxy-probe');
                    const pre = dialog.querySelector('#proxy-result');
                    btn.disabled = true; btn.textContent = 'ğŸ§ª è‡ªæ£€ä¸­...'; pre.textContent = '(è¿è¡Œä¸­...)';
                    try {
                        const report = await window.SmartCORSProxy?.probeProxies?.({ proxies: list, timeoutMs: 8000 }) || [];
                        pre.textContent = JSON.stringify(report, null, 2);
                        // å¯è§†åŒ–æ¸²æŸ“
                        const sumEl = dialog.querySelector('#proxy-summary');
                        const repEl = dialog.querySelector('#proxy-report');
                        const esc = (s) => String(s || '').replaceAll('<','&lt;').replaceAll('>','&gt;');
                        const total = report.length;
                        const reach = report.filter(r => r.simpleGet?.ok).length;
                        const headers = report.filter(r => r.forwardedAuthorization).length;
                        const posts = report.filter(r => r.postSupported).length;
                        sumEl.innerHTML = `
                            <div style="display:flex;gap:12px;flex-wrap:wrap;align-items:center;">
                                <span>æ€»è®¡: <strong>${total}</strong></span>
                                <span>å¯è¾¾: <strong style="color:#16a34a">${reach}</strong></span>
                                <span>è½¬å‘å¤´: <strong style="color:${headers>0?'#16a34a':'#64748b'}">${headers}</strong></span>
                                <span>POST: <strong style="color:${posts>0?'#16a34a':'#dc2626'}">${posts}</strong></span>
                            </div>`;
                        const header = `
                            <div style="display:grid;grid-template-columns:1.6fr 0.9fr 0.9fr 0.8fr 0.6fr 0.5fr 2fr;gap:0;border-bottom:1px solid var(--bd);background:var(--bg);color:var(--muted);font-size:12px;">
                                <div style="padding:8px 10px;">ä»£ç†</div>
                                <div style="padding:8px 10px;">è¿é€šæ€§</div>
                                <div style="padding:8px 10px;">è½¬å‘å¤´</div>
                                <div style="padding:8px 10px;">POST</div>
                                <div style="padding:8px 10px;">å»¶è¿Ÿ</div>
                                <div style="padding:8px 10px;">HTTP</div>
                                <div style="padding:8px 10px;">å¤‡æ³¨</div>
                            </div>`;
                        const yes = (t) => `<span style="background:#dcfce7;color:#166534;border:1px solid #bbf7d0;padding:2px 6px;border-radius:999px;font-size:12px;">âœ… ${t}</span>`;
                        const no = (t) => `<span style="background:#fee2e2;color:#991b1b;border:1px solid #fecaca;padding:2px 6px;border-radius:999px;font-size:12px;">âŒ ${t}</span>`;
                        const neutral = (t) => `<span style="background:#f1f5f9;color:#475569;border:1px solid #e2e8f0;padding:2px 6px;border-radius:999px;font-size:12px;">â€” ${t}</span>`;
                        const rows = report.map(r => {
                            const reachOk = !!(r.simpleGet && r.simpleGet.ok);
                            const status = (r.simpleGet && typeof r.simpleGet.status !== 'undefined') ? r.simpleGet.status : '-';
                            const latency = (r.simpleGet && r.simpleGet.latencyMs) ? `${r.simpleGet.latencyMs}ms` : '-';
                            const fwd = !!r.forwardedAuthorization;
                            const post = !!r.postSupported;
                            return `
                                <div style="display:grid;grid-template-columns:1.6fr 0.9fr 0.9fr 0.8fr 0.6fr 0.5fr 2fr;gap:0;border-top:1px solid var(--bd);">
                                    <div style="padding:10px;">
                                        <div style="font-weight:600;">${esc(r.name)}</div>
                                        <div style="color:var(--muted);font-size:12px;margin-top:2px;">${esc(r.base || '')}</div>
                                    </div>
                                    <div style="padding:10px;">${reachOk ? yes('å¯è¾¾') : no('å¤±è´¥')}</div>
                                    <div style="padding:10px;">${fwd ? yes('å·²è½¬å‘') : neutral('ä¸ä¿è¯')}</div>
                                    <div style="padding:10px;">${post ? yes('æ”¯æŒ') : no('ä¸æ”¯æŒ')}</div>
                                    <div style="padding:10px;">${latency}</div>
                                    <div style="padding:10px;">${status}</div>
                                    <div style="padding:10px;color:var(--muted);font-size:12px;">${esc(r.notes || '')}</div>
                                </div>`;
                        }).join('');
                        repEl.innerHTML = header + rows;
                        sumEl.style.display = 'block';
                        repEl.style.display = 'block';
                        showToast('è‡ªæ£€å®Œæˆ', 'success');
                    } catch (e) {
                        pre.textContent = 'è‡ªæ£€å¤±è´¥: ' + (e?.message || e);
                        showToast('è‡ªæ£€å¤±è´¥', 'error');
                    } finally {
                        btn.disabled = false; btn.textContent = 'ğŸ§ª è¿è¡Œè‡ªæ£€';
                    }
                };
                // Toggle raw JSON visibility
                dialog.querySelector('#proxy-toggle-json').onclick = () => {
                    const pre = dialog.querySelector('#proxy-result');
                    const btn = dialog.querySelector('#proxy-toggle-json');
                    const showing = pre.style.display !== 'none';
                    pre.style.display = showing ? 'none' : 'block';
                    btn.textContent = showing ? 'ğŸ§¾ æ˜¾ç¤ºJSON' : 'ğŸ§¾ éšè—JSON';
                };
                dialog.querySelector('#proxy-copy').onclick = async () => {
                    const pre = dialog.querySelector('#proxy-result');
                    const text = pre?.textContent || '';
                    try { await navigator.clipboard?.writeText(text); showToast('ç»“æœå·²å¤åˆ¶', 'success'); } catch {}
                };
            }

            render();
            overlay.appendChild(dialog);
            document.body.appendChild(overlay);
            overlay.onclick = (e) => { if (e.target === overlay) overlay.remove(); };
        }

        // ç°åœ¨ç»™actionså¯¹è±¡èµ‹å€¼
        actions.auth = function() {
            try {
                oauth.start();
            } catch (error) {
                console.error('OAuthå¯åŠ¨å¤±è´¥:', error);
                showToast('è®¤è¯å¯åŠ¨å¤±è´¥: ' + error.message, 'error');
            }
        };

        actions.manage = function() {
            try {
                showCredentialManagement(); // åˆ·æ–°å‡­è¯ç®¡ç†ç•Œé¢
                showToast('å‡­è¯åˆ—è¡¨å·²åˆ·æ–°', 'success');
            } catch (error) {
                console.error('ç®¡ç†åŠŸèƒ½å¯åŠ¨å¤±è´¥:', error);
                showToast('ç®¡ç†åŠŸèƒ½å¯åŠ¨å¤±è´¥: ' + error.message, 'error');
            }
        };

        actions.import = function() {
            try {
                showImportDialog();
            } catch (error) {
                console.error('å¯¼å…¥å¯¹è¯æ¡†æ‰“å¼€å¤±è´¥:', error);
                showToast('å¯¼å…¥åŠŸèƒ½å¯åŠ¨å¤±è´¥: ' + error.message, 'error');
            }
        };

        actions.export = function() {
            try {
                showExportDialog();
            } catch (error) {
                console.error('å¯¼å‡ºå¯¹è¯æ¡†æ‰“å¼€å¤±è´¥:', error);
                showToast('å¯¼å‡ºåŠŸèƒ½å¯åŠ¨å¤±è´¥: ' + error.message, 'error');
            }
        };

        // åœ†ç¯è¿›åº¦å›¾è¡¨SVGç”Ÿæˆå‡½æ•°
        function ringChartSVG(used, total) {
            total = Number(total) || 0;
            used = Number(used) || 0;
            const pct = total > 0 ? Math.round((total - used) / total * 100) : 100;
            const r = 18, c = 20, per = 2 * Math.PI * r, val = (pct / 100) * per;
            return `<svg width="46" height="46" viewBox="0 0 40 40">
                <circle cx="20" cy="20" r="${r}" fill="none" stroke="#e5e7eb" stroke-width="4"></circle>
                <circle cx="20" cy="20" r="${r}" fill="none" stroke="#60a5fa" stroke-width="4" stroke-dasharray="${val} ${per - val}" transform="rotate(-90 ${c} ${c})"></circle>
                <text x="20" y="22" text-anchor="middle" font-size="10" fill="currentColor">${pct}%</text>
            </svg>`;
        }

        // {{ AURA-X: Modify - å¢å¼ºæ ¼å¼åŒ–åˆ°æœŸæ—¶é—´æ˜¾ç¤ºï¼Œå‚è€ƒyouhou.jsæ ·å¼. Approval: å¯¸æ­¢(ID:1735308000). }}
        // æ ¼å¼åŒ–åˆ°æœŸæ—¶é—´æ˜¾ç¤º
        function formatExpiryDate(dateStr) {
            if (!dateStr) return '';

            const date = new Date(dateStr);
            const now = new Date();

            // {{ AURA-X: Modify - ä¿®å¤å¤©æ•°è®¡ç®—ï¼Œå‚è€ƒyouhou.jsçš„åŒ—äº¬æ—¶é—´è®¡ç®—æ–¹å¼. Approval: å¯¸æ­¢(ID:1735308000). }}
            // è®¡ç®—å¤©æ•°å·® - ä½¿ç”¨æ—¥æœŸå¯¹é½åˆ°å¤©çš„å¼€å§‹
            const endDate = new Date(date.getFullYear(), date.getMonth(), date.getDate());
            const nowDate = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const diffTime = endDate.getTime() - nowDate.getTime();
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));

            // å‘¨å‡ æ˜ å°„
            const weekdays = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];
            const weekday = weekdays[date.getDay()];

            // æ ¼å¼åŒ–æ—¥æœŸæ—¶é—´åˆ°åˆ†é’Ÿï¼ˆå‚è€ƒyouhou.jsæ ¼å¼ï¼‰
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');

            const formattedDate = `${year}-${month}-${day} ${hours}:${minutes}`;

            // {{ AURA-X: Modify - ä¿®æ”¹è¿”å›æ ¼å¼ï¼Œå‚è€ƒyouhou.jsæ ·å¼. Approval: å¯¸æ­¢(ID:1735308000). }}
            // {{ AURA-X: Modify - å¢åŠ æ˜å¤©åˆ°æœŸçš„æ˜¾ç¤º. Approval: å¯¸æ­¢(ID:1735308000). }}
            // å¤©æ•°åç¼€
            let daysText = '';
            if (diffDays > 1) {
                daysText = `${diffDays}å¤©ååˆ°æœŸ`;
            } else if (diffDays === 1) {
                daysText = 'æ˜å¤©åˆ°æœŸ';
            } else if (diffDays === 0) {
                daysText = 'ä»Šå¤©åˆ°æœŸ';
            } else {
                daysText = `å·²è¿‡æœŸ${Math.abs(diffDays)}å¤©`;
            }

            return {
                formattedDate: `${formattedDate}${weekday}`,
                daysText: daysText,
                diffDays: diffDays
            };
        }

        // æ˜¾ç¤ºå‡­è¯ç®¡ç†ç•Œé¢ï¼ˆåœ¨ä¸»é¡µé¢ä¸Šï¼Œä¸æ˜¯å¼¹çª—ï¼‰
        function showCredentialManagement() {
            const creds = store.get();
            const mainContent = $('#main-content');

            if (!mainContent) return;

            if (creds.length === 0) {
                // æ²¡æœ‰å‡­è¯æ—¶æ˜¾ç¤ºç©ºçŠ¶æ€
                mainContent.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: var(--muted);">
                        <h3>ğŸ”‘ æš‚æ— å‡­è¯</h3>
                        <p>ç‚¹å‡»ä¸Šæ–¹"è·å–ä»¤ç‰Œ"æŒ‰é’®å¼€å§‹æ·»åŠ å‡­è¯</p>
                        <div style="margin-top: 20px;">
                            <button class="btn btn-primary" onclick="actions.auth()">ğŸš€ è·å–ä»¤ç‰Œ</button>
                        </div>
                    </div>
                `;
                return;
            }

            // åˆ†ç±»å‡­è¯
            const activeCreds = creds.filter(c => c.status === 'ACTIVE');
            const invalidCreds = creds.filter(c => ['EXPIRED', 'NO_BALANCE', 'ERROR', 'NETWORK_ERROR', 'AUTH_ERROR', 'BANNED'].includes(c.status));
            const otherCreds = creds.filter(c => !activeCreds.includes(c) && !invalidCreds.includes(c));

            // æ·»åŠ ç»Ÿè®¡ä¿¡æ¯
            const stats = getCredentialStats(creds);

            // æ›´æ–°ç³»ç»ŸçŠ¶æ€æ˜¾ç¤ºï¼Œé›†æˆæ€»ä½“é¢åº¦ä¿¡æ¯
            const statusBox = document.getElementById('status');
            const readyDiv = document.getElementById('ready');

            if (readyDiv && stats.validBalanceCount > 0 && stats.validIncludedCount > 0 && stats.totalIncluded > 0) {
                const progressPercentage = Math.min((stats.totalBalance / stats.totalIncluded) * 100, 100);
                const progressClass = progressPercentage > 80 ? '' : progressPercentage > 50 ? 'warning' : 'danger';

                // {{ AURA-X: Modify - å»æ‰ç³»ç»Ÿå°±ç»ªæç¤ºï¼Œåªä¿ç•™ç»Ÿè®¡ä¿¡æ¯. Approval: å¯¸æ­¢(ID:1735308000). }}
                readyDiv.innerHTML = `
                    <div style="display: flex; align-items: center; justify-content: center; gap: 15px; flex-wrap: wrap;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            ${ringChartSVG(stats.totalIncluded - stats.totalBalance, stats.totalIncluded)}
                            <span style="margin-left: 4px; color: var(--muted);">æ€»ä½™é¢ <span style="font-weight: 800; color: var(--fg); font-size: 16px;">${Math.round(stats.totalBalance)}</span> / ${Math.round(stats.totalIncluded)}</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 12px; font-size: 14px;">
                            <span style="color: var(--muted);">âœ… æ­£å¸¸ <span style="font-weight: 600; color: #16a34a;">${stats.active}</span></span>
                            <span style="color: var(--muted);">ğŸ”’ å¼‚å¸¸ <span style="font-weight: 600; color: #dc2626;">${stats.abnormal}</span></span>
                            <span style="color: var(--muted);">âš ï¸ æ— ä»¤ç‰Œ <span style="font-weight: 600; color: #64748b;">${stats.noToken}</span></span>
                        </div>
                    </div>
                `;
            } else if (readyDiv) {
                // {{ AURA-X: Modify - å»æ‰ç³»ç»Ÿå°±ç»ªæç¤º. Approval: å¯¸æ­¢(ID:1735308000). }}
                readyDiv.innerHTML = '';
            }

            const statsHtml = `
                <div style="display: flex; gap: 20px; margin-bottom: 20px; flex-wrap: wrap; align-items: center;">
                    <div class="stat-item">æ€»è®¡: <span style="font-weight: 600;">${stats.total}</span></div>
                    <div class="stat-item">æ­£å¸¸: <span style="color: #16a34a; font-weight: 600;">${stats.active}</span></div>
                    <div class="stat-item">å¼‚å¸¸: <span style="color: #dc2626; font-weight: 600;">${stats.abnormal}</span></div>
                    <div class="stat-item">æ— ä»¤ç‰Œ: <span style="color: #64748b; font-weight: 600;">${stats.noToken}</span></div>
                </div>
            `;

            // ç”Ÿæˆåˆ†ç±»åŒºåŸŸHTML
            let contentHtml = '';

            // æ­£å¸¸å‡­è¯åŒºåŸŸï¼ˆé»˜è®¤å±•å¼€ï¼‰
            if (activeCreds.length > 0) {
                contentHtml += generateCredentialSection('active', 'âœ… æ­£å¸¸å‡­è¯', activeCreds, true);
            }

            // å¤±æ•ˆå‡­è¯åŒºåŸŸï¼ˆé»˜è®¤æ”¶èµ·ï¼‰
            if (invalidCreds.length > 0) {
                contentHtml += generateCredentialSection('invalid', 'âŒ å¤±æ•ˆå‡­è¯', invalidCreds, false);
            }

            // å…¶ä»–å‡­è¯åŒºåŸŸï¼ˆé»˜è®¤æ”¶èµ·ï¼‰
            if (otherCreds.length > 0) {
                contentHtml += generateCredentialSection('other', 'âš ï¸ å…¶ä»–å‡­è¯', otherCreds, false);
            }

            mainContent.innerHTML = statsHtml + contentHtml;
        }

        // {{ AURA-X: Modify - å¢å¼ºè¿›åº¦æ¡æ˜¾ç¤ºï¼Œæ·»åŠ åˆ°æœŸæ—¶é—´ä¿¡æ¯. Approval: å¯¸æ­¢(ID:1735308000). }}
        // ç”Ÿæˆå‡­è¯è¿›åº¦æ¡
        function generateCredentialProgressBars(cred) {
            let progressHtml = '';

            // {{ AURA-X: Modify - ä¿®å¤ç¤¾åŒºè´¦å·ä¿¡æ¯æ˜¾ç¤ºï¼Œå³ä½¿æ²¡æœ‰è¿‡æœŸæ—¶é—´ä¹Ÿæ˜¾ç¤ºä½™é¢. Approval: å¯¸æ­¢(ID:1735308000). }}
            // ç”Ÿæˆè´¦å·ä¿¡æ¯ï¼ˆå‚è€ƒyouhou.jsæ ·å¼ï¼‰
            let expiryInfoHtml = '';
            const balance = parseFloat(cred.lastBalance) || 0;
            const included = parseFloat(cred.lastIncluded) || 0;

            // åˆ¤æ–­æ˜¯å¦ä¸ºç¤¾åŒºè´¦å·ï¼ˆæ²¡æœ‰è¿‡æœŸæ—¶é—´ä¸”çŠ¶æ€ä¸æ˜¯EXPIREDï¼‰
            const isCommunity = !cred.lastEndDate && cred.status !== 'EXPIRED';

            if (cred.lastEndDate) {
                // æœ‰è¿‡æœŸæ—¶é—´çš„æ­£å¸¸è´¦å·
                const expiryInfo = formatExpiryDate(cred.lastEndDate);

                // {{ AURA-X: Modify - å»æ‰é¢œè‰²å˜åŒ–ï¼Œä½¿ç”¨ç»Ÿä¸€çš„é»˜è®¤æ ·å¼. Approval: å¯¸æ­¢(ID:1735308000). }}
                // ä½¿ç”¨ç»Ÿä¸€çš„é»˜è®¤æ ·å¼ï¼Œä¸æ ¹æ®åˆ°æœŸçŠ¶æ€å˜åŒ–é¢œè‰²
                const chipStyle = 'background: var(--chip); color: var(--fg); border: 1px solid var(--bd);';

                expiryInfoHtml = `
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; flex-wrap: wrap;">
                        ${balance && included ? `<span style="padding: 3px 8px; border-radius: 6px; font-family: ui-monospace, monospace; font-size: 14px; font-weight: 600; background: #f0fdf4; color: #16a34a; border: 1px solid #bbf7d0;">${Math.round(balance)} / ${Math.round(included)}</span>` : ''}
                        <span style="padding: 3px 8px; border-radius: 6px; font-family: ui-monospace, monospace; font-size: 14px; font-weight: 500; ${chipStyle}">${expiryInfo.formattedDate}</span>
                        <span style="padding: 3px 8px; border-radius: 6px; font-family: ui-monospace, monospace; font-size: 14px; font-weight: 600; ${chipStyle}">${expiryInfo.daysText}</span>
                    </div>
                `;
            } else if (isCommunity && (balance || included)) {
                // ç¤¾åŒºè´¦å·ï¼ˆæ²¡æœ‰è¿‡æœŸæ—¶é—´ï¼‰
                expiryInfoHtml = `
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px; flex-wrap: wrap;">
                        ${balance && included ? `<span style="padding: 3px 8px; border-radius: 6px; font-family: ui-monospace, monospace; font-size: 14px; font-weight: 600; background: #f0fdf4; color: #16a34a; border: 1px solid #bbf7d0;">${Math.round(balance)} / ${Math.round(included)}</span>` : ''}
                        <span style="padding: 3px 8px; border-radius: 6px; font-family: ui-monospace, monospace; font-size: 14px; font-weight: 500; background: var(--chip); color: var(--fg); border: 1px solid var(--bd);">ç¤¾åŒºè®¡åˆ’ï¼ˆæ¯æœˆï¼‰</span>
                    </div>
                `;
            }

            // å¦‚æœæœ‰ä½™é¢å’Œæ€»é¢åº¦æ•°æ®ï¼Œæ˜¾ç¤ºè¿›åº¦æ¡
            if (cred.lastBalance && cred.lastIncluded && !isNaN(parseFloat(cred.lastBalance)) && !isNaN(parseFloat(cred.lastIncluded))) {
                const balance = parseFloat(cred.lastBalance);
                const included = parseFloat(cred.lastIncluded);
                const percentage = Math.min((balance / included) * 100, 100);
                const progressClass = percentage > 80 ? '' : percentage > 50 ? 'warning' : 'danger';

                progressHtml = `
                    <div style="margin-bottom: 8px;">
                        ${expiryInfoHtml}
                        <!-- {{ AURA-X: Remove - å»æ‰ä½™é¢å’Œæ€»é¢åº¦æ ‡ç­¾æ–‡å­—. Approval: å¯¸æ­¢(ID:1735308000). }} -->
                        <div class="progress-container">
                            <div class="progress-bar ${progressClass}" style="width: ${percentage}%"></div>
                            <!-- {{ AURA-X: Remove - å»æ‰è¿›åº¦æ¡ç™¾åˆ†æ¯”æ˜¾ç¤º. Approval: å¯¸æ­¢(ID:1735308000). }} -->
                        </div>
                    </div>
                `;
            } else {
                // {{ AURA-X: Modify - å³ä½¿æ²¡æœ‰å®Œæ•´æ•°æ®ä¹Ÿæ˜¾ç¤ºåˆ°æœŸæ—¶é—´ä¿¡æ¯. Approval: å¯¸æ­¢(ID:1735308000). }}
                // å¦‚æœæ²¡æœ‰å®Œæ•´æ•°æ®ï¼Œåªæ˜¾ç¤ºåˆ°æœŸæ—¶é—´ä¿¡æ¯
                progressHtml = `<div style="margin-bottom: 8px;">${expiryInfoHtml}</div>`;
            }

            return progressHtml;
        }

        // ç”Ÿæˆå‡­è¯åˆ†ç±»åŒºåŸŸ
        function generateCredentialSection(sectionId, title, creds, isExpanded) {
            const expandedClass = isExpanded ? 'expanded' : 'collapsed';
            const displayStyle = isExpanded ? 'block' : 'none';
            const arrowIcon = isExpanded ? 'â–¼' : 'â–¶';

            // AURA-Xåè®®ï¼šä¸ºå¤±æ•ˆå‡­è¯å’Œå…¶ä»–å‡­è¯æ·»åŠ æ¸…ç©ºæŒ‰é’®ï¼Œä¸ºæ­£å¸¸å‡­è¯æ·»åŠ ä¸€é”®æ£€æµ‹æŒ‰é’®
            const showClearButton = sectionId === 'invalid' || sectionId === 'other';
            const showCheckButton = sectionId === 'active';

            const clearButtonHtml = showClearButton ? `
                <button class="btn btn-danger btn-sm"
                        onclick="clearCredentialSection('${sectionId}', '${title}')"
                        style="margin-left: 8px; font-size: 11px; padding: 4px 8px;"
                        title="æ¸…ç©º${title}ä¸‹çš„æ‰€æœ‰è´¦å·">
                    ğŸ—‘ï¸ æ¸…ç©º
                </button>
            ` : '';

            const checkButtonHtml = showCheckButton ? `
                <button class="btn btn-primary btn-sm"
                        onclick="checkAllActiveCredentials()"
                        style="margin-left: 8px; font-size: 11px; padding: 4px 8px;"
                        title="æ£€æµ‹æ‰€æœ‰æ­£å¸¸å‡­è¯çš„çŠ¶æ€">
                    ğŸ”„ ä¸€é”®æ£€æµ‹
                </button>
            ` : '';

            let cardsHtml = `
                <div class="credential-section ${expandedClass}" style="margin-bottom: 20px;">
                    <div class="section-header" style="
                        display: flex; align-items: center; justify-content: space-between;
                        background: var(--panel); border: 1px solid var(--bd); border-radius: 8px;
                        padding: 12px 16px; user-select: none;
                        transition: all 0.2s ease;
                    ">
                        <div style="display: flex; align-items: center; gap: 8px; cursor: pointer;" onclick="toggleCredentialSection('${sectionId}')">
                            <span class="arrow-icon" style="font-size: 12px; transition: transform 0.2s ease;">${arrowIcon}</span>
                            <h3 style="margin: 0; font-size: 16px; font-weight: 600;">${title}</h3>
                            <span style="
                                background: var(--chip); color: var(--muted);
                                padding: 2px 8px; border-radius: 12px; font-size: 12px;
                            ">${creds.length}</span>
                        </div>
                        <div style="display: flex; align-items: center;">
                            ${clearButtonHtml}
                            ${checkButtonHtml}
                        </div>
                    </div>
                    <div class="section-content" id="section-${sectionId}" style="
                        display: ${displayStyle}; 
                        transition: all 0.3s ease;
                        overflow: hidden;
                    ">
                        <div style="
                            display: grid; 
                            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); 
                            gap: 20px; 
                            padding: 20px 0;
                        ">
            `;

            creds.forEach(cred => {
                const statusColor = getStatusColor(cred.status || 'UNKNOWN');
                const statusText = getStatusText(cred.status || 'UNKNOWN');

                cardsHtml += `
                    <div class="credential-card" data-cred-id="${cred.id}" style="
                        background: var(--bg);
                        border: 2px solid ${statusColor.border};
                        border-radius: 12px;
                        padding: 16px;
                        box-shadow: 0 4px 12px -4px rgba(0,0,0,.1);
                        position: relative;
                    ">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px;">
                            <h4 style="margin: 0; color: var(--fg); font-size: 16px; font-weight: 600;">
                                ${cred.email || `ID: ${cred.id}`}
                            </h4>
                            <span style="
                                background: ${statusColor.bg};
                                color: ${statusColor.text};
                                padding: 4px 8px;
                                border-radius: 6px;
                                font-size: 12px;
                                font-weight: 600;
                            ">${statusText}</span>
                        </div>

                        <div style="margin-bottom: 12px; font-size: 14px; color: var(--muted);">
                            <!-- {{ AURA-X: Remove - å»æ‰ç§Ÿæˆ·URLæ˜¾ç¤º. Approval: å¯¸æ­¢(ID:1735308000). }} -->
                            ${generateCredentialProgressBars(cred)}
                            <!-- {{ AURA-X: Remove - å»æ‰é‡å¤çš„åˆ°æœŸæ—¶é—´æ˜¾ç¤ºï¼Œå·²åœ¨è¿›åº¦æ¡ä¸Šæ–¹æ˜¾ç¤º. Approval: å¯¸æ­¢(ID:1735308000). }} -->
                            ${cred.lastError ? `<div style="margin-bottom: 4px; color: #dc2626;">âŒ ${cred.lastError}</div>` : ''}
                        </div>

                        <div style="display: flex; gap: 8px; justify-content: flex-end;">
                            <button class="btn btn-ghost" style="font-size: 12px; padding: 6px 12px;" onclick="showCredentialDetails('${cred.id}')" title="æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯">è¯¦æƒ…</button>
                            <button class="btn btn-secondary check-btn" style="font-size: 12px; padding: 6px 12px;" onclick="checkCredential('${cred.id}')">æ£€æµ‹</button>
                            <button class="btn btn-danger" style="font-size: 12px; padding: 6px 12px;" onclick="deleteCredential('${cred.id}')">åˆ é™¤</button>
                        </div>
                    </div>
                `;
            });

            cardsHtml += `
                        </div>
                    </div>
                </div>
            `;

            return cardsHtml;
        }

        // AURA-Xåè®®ï¼šæ¸…ç©ºæŒ‡å®šåˆ†ç±»çš„å‡­è¯
        function clearCredentialSection(sectionId, sectionTitle) {
            const creds = store.get();
            let targetCreds = [];

            if (sectionId === 'invalid') {
                // å¤±æ•ˆå‡­è¯ï¼šåŒ…å«æ‰€æœ‰å¤±æ•ˆçŠ¶æ€
                const invalidStatuses = ['EXPIRED', 'NO_BALANCE', 'ERROR', 'NETWORK_ERROR', 'AUTH_ERROR', 'BANNED'];
                targetCreds = creds.filter(c => invalidStatuses.includes(c.status));
            } else if (sectionId === 'other') {
                // å…¶ä»–å‡­è¯ï¼šä¸æ˜¯æ­£å¸¸ä¹Ÿä¸æ˜¯å¤±æ•ˆçš„æ‰€æœ‰å‡­è¯
                const activeStatuses = ['ACTIVE'];
                const invalidStatuses = ['EXPIRED', 'NO_BALANCE', 'ERROR', 'NETWORK_ERROR', 'AUTH_ERROR', 'BANNED'];
                targetCreds = creds.filter(c => !activeStatuses.includes(c.status) && !invalidStatuses.includes(c.status));
            }

            if (targetCreds.length === 0) {
                showToast(`${sectionTitle}ä¸­æ²¡æœ‰å¯æ¸…ç©ºçš„å‡­è¯`, 'info');
                return;
            }

            if (confirm(`ç¡®å®šè¦æ¸…ç©º${sectionTitle}ä¸‹çš„ ${targetCreds.length} ä¸ªè´¦å·å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼`)) {
                const remainingCreds = creds.filter(c => !targetCreds.includes(c));
                store.set(remainingCreds);
                showToast(`å·²æ¸…ç©º${sectionTitle}ä¸‹çš„ ${targetCreds.length} ä¸ªè´¦å·`, 'success');
                showCredentialManagement(); // åˆ·æ–°æ˜¾ç¤º
            }
        }

        // åˆ‡æ¢å‡­è¯åˆ†ç±»åŒºåŸŸçš„å±•å¼€/æ”¶èµ·çŠ¶æ€
        function toggleCredentialSection(sectionId) {
            const section = document.querySelector(`.credential-section:has(#section-${sectionId})`);
            const content = document.getElementById(`section-${sectionId}`);
            const arrow = section?.querySelector('.arrow-icon');

            if (!section || !content || !arrow) return;

            const isExpanded = section.classList.contains('expanded');

            if (isExpanded) {
                // æ”¶èµ·åŠ¨ç”»
                content.classList.add('collapsing');
                section.classList.remove('expanded');
                section.classList.add('collapsed');
                arrow.textContent = 'â–¶';
                
                setTimeout(() => {
                    content.style.display = 'none';
                    content.classList.remove('collapsing');
                }, 300);
            } else {
                // å±•å¼€åŠ¨ç”»
                content.style.display = 'block';
                content.classList.add('collapsing');
                section.classList.remove('collapsed');
                section.classList.add('expanded');
                arrow.textContent = 'â–¼';
                
                setTimeout(() => {
                    content.classList.remove('collapsing');
                }, 50);
            }
        }

        // è·å–çŠ¶æ€é¢œè‰²
        function getStatusColor(status) {
            const colors = {
                'ACTIVE': { bg: '#dcfce7', text: '#166534', border: '#16a34a' },
                'EXPIRED': { bg: '#fee2e2', text: '#991b1b', border: '#dc2626' },
                'NO_BALANCE': { bg: '#fef3c7', text: '#92400e', border: '#f59e0b' },
                'ERROR': { bg: '#fef2f2', text: '#991b1b', border: '#ef4444' },
                'NO_TOKEN': { bg: '#f1f5f9', text: '#475569', border: '#64748b' },
                'NETWORK_ERROR': { bg: '#fef3c7', text: '#92400e', border: '#f59e0b' },
                'AUTH_ERROR': { bg: '#fee2e2', text: '#991b1b', border: '#dc2626' },
                'BANNED': { bg: '#fef2f2', text: '#991b1b', border: '#ef4444' },
                'UNKNOWN': { bg: '#f8fafc', text: '#64748b', border: '#cbd5e1' }
            };
            return colors[status] || colors['UNKNOWN'];
        }

        // è·å–çŠ¶æ€æ–‡æœ¬
        function getStatusText(status) {
            const texts = {
                'ACTIVE': 'æ­£å¸¸',
                'EXPIRED': 'å·²è¿‡æœŸ',
                'NO_BALANCE': 'ä½™é¢ä¸è¶³',
                'ERROR': 'æ£€æµ‹å¤±è´¥',
                'NO_TOKEN': 'æ— ä»¤ç‰Œ',
                'NETWORK_ERROR': 'ç½‘ç»œé”™è¯¯',
                'AUTH_ERROR': 'è®¤è¯å¤±è´¥',
                'BANNED': 'è´¦æˆ·è¢«å°',
                'UNKNOWN': 'æœªçŸ¥'
            };
            return texts[status] || 'æœªçŸ¥';
        }

        // è·å–å‡­è¯ç»Ÿè®¡ä¿¡æ¯
        function getCredentialStats(creds) {
            const activeCreds = creds.filter(c => c.status === 'ACTIVE');

            // è®¡ç®—æ€»ä½™é¢å’Œæ€»é¢åº¦ï¼ˆä»…ç»Ÿè®¡æ­£å¸¸å‡­è¯ï¼‰
            let totalBalance = 0;
            let totalIncluded = 0;
            let validBalanceCount = 0;
            let validIncludedCount = 0;

            activeCreds.forEach(cred => {
                if (cred.lastBalance && !isNaN(parseFloat(cred.lastBalance))) {
                    totalBalance += parseFloat(cred.lastBalance);
                    validBalanceCount++;
                }
                if (cred.lastIncluded && !isNaN(parseFloat(cred.lastIncluded))) {
                    totalIncluded += parseFloat(cred.lastIncluded);
                    validIncludedCount++;
                }
            });

            return {
                total: creds.length,
                active: activeCreds.length,
                abnormal: creds.filter(c => ['EXPIRED', 'NO_BALANCE', 'ERROR', 'NETWORK_ERROR', 'AUTH_ERROR', 'BANNED'].includes(c.status)).length,
                noToken: creds.filter(c => c.status === 'NO_TOKEN').length,
                networkError: creds.filter(c => c.status === 'NETWORK_ERROR').length,
                totalBalance: totalBalance,
                totalIncluded: totalIncluded,
                validBalanceCount: validBalanceCount,
                validIncludedCount: validIncludedCount
            };
        }

        // æ£€æµ‹å‡­è¯
        async function checkCredential(id) {
            const creds = store.get();
            const cred = creds.find(c => c.id == id);
            if (!cred) {
                showToast('å‡­è¯ä¸å­˜åœ¨', 'error');
                return;
            }

            // æ˜¾ç¤ºæ£€æµ‹ä¸­çŠ¶æ€
            showCredentialLoading(id, true);
            showToast('æ­£åœ¨æ£€æµ‹å‡­è¯...', 'info');

            try {
                const status = await balance.check(cred);
                const statusText = getStatusText(status);
                showToast(`æ£€æµ‹å®Œæˆ: ${statusText}`, 'success');

                // åˆ·æ–°æ˜¾ç¤º
                showCredentialManagement();
            } catch (error) {
                console.error('æ£€æµ‹å¤±è´¥:', error);
                showToast('æ£€æµ‹å¤±è´¥: ' + error.message, 'error');
            } finally {
                showCredentialLoading(id, false);
            }
        }

        // æ˜¾ç¤ºæ£€æµ‹ä¸­çŠ¶æ€
        function showCredentialLoading(id, isLoading) {
            const card = document.querySelector(`[data-cred-id="${id}"]`);
            if (!card) return;

            const checkBtn = card.querySelector('.check-btn');
            if (checkBtn) {
                if (isLoading) {
                    checkBtn.disabled = true;
                    checkBtn.innerHTML = '<span class="spin" style="width: 12px; height: 12px; margin-right: 4px;"></span>æ£€æµ‹ä¸­...';
                } else {
                    checkBtn.disabled = false;
                    checkBtn.innerHTML = 'æ£€æµ‹';
                }
            }
        }

        // æ˜¾ç¤ºå‡­è¯è¯¦æƒ…
        function showCredentialDetails(id) {
            const creds = store.get();
            const cred = creds.find(c => c.id == id);
            if (!cred) {
                showToast('å‡­è¯ä¸å­˜åœ¨', 'error');
                return;
            }

            // åˆ›å»ºè¯¦æƒ…å¼¹çª—
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed; inset: 0; background: rgba(0,0,0,.5); z-index: 9999;
                display: flex; align-items: center; justify-content: center;
            `;

            const dialog = document.createElement('div');
            dialog.style.cssText = `
                background: var(--bg); border-radius: 12px; padding: 20px;
                max-width: 600px; width: 90vw; max-height: 80vh; overflow-y: auto;
                box-shadow: 0 25px 60px -12px rgba(0,0,0,.28);
                color: var(--fg);
            `;

            // æ„å»º subToken é“¾æ¥ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
            const subTokenDisplay = cred.subToken ?
                `<a href="https://portal.withorb.com/view?token=${cred.subToken}" target="_blank"
                   style="color: #3b82f6; text-decoration: none; word-break: break-all;"
                   title="ç‚¹å‡»æŸ¥çœ‹ç”¨é‡è¯¦æƒ…">
                   https://portal.withorb.com/view?token=${cred.subToken}
                </a>` :
                '<span style="color: var(--muted);">æœªè®¾ç½®</span>';

            dialog.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="margin: 0; color: var(--fg);">ğŸ”‘ å‡­è¯è¯¦æƒ…</h2>
                    <button id="close-details" class="btn btn-ghost">âœ•</button>
                </div>

                <div style="display: grid; gap: 16px;">
                    <div style="background: var(--panel); border: 1px solid var(--bd); border-radius: 8px; padding: 16px;">
                        <h4 style="margin: 0 0 12px 0; color: var(--fg); font-size: 14px; font-weight: 600;">åŸºæœ¬ä¿¡æ¯</h4>
                        <div style="display: grid; gap: 8px; font-size: 14px;">
                            <div style="display: grid; grid-template-columns: 80px 1fr; gap: 12px;">
                                <span style="color: var(--muted); font-weight: 500;">ID:</span>
                                <span style="font-family: ui-monospace, monospace; color: var(--fg);">${cred.id || 'N/A'}</span>
                            </div>
                            <div style="display: grid; grid-template-columns: 80px 1fr; gap: 12px;">
                                <span style="color: var(--muted); font-weight: 500;">é‚®ç®±:</span>
                                <span style="color: var(--fg);">${cred.email || 'æœªè®¾ç½®'}</span>
                            </div>
                            <div style="display: grid; grid-template-columns: 80px 1fr; gap: 12px;">
                                <span style="color: var(--muted); font-weight: 500;">ç§Ÿæˆ·:</span>
                                <span style="font-family: ui-monospace, monospace; color: var(--fg); word-break: break-all;">${cred.tenant || 'æœªè®¾ç½®'}</span>
                            </div>
                        </div>
                    </div>

                    <div style="background: var(--panel); border: 1px solid var(--bd); border-radius: 8px; padding: 16px;">
                        <h4 style="margin: 0 0 12px 0; color: var(--fg); font-size: 14px; font-weight: 600;">ä»¤ç‰Œä¿¡æ¯</h4>
                        <div style="display: grid; gap: 12px; font-size: 14px;">
                            <div>
                                <div style="color: var(--muted); font-weight: 500; margin-bottom: 4px;">Token:</div>
                                <div style="
                                    font-family: ui-monospace, monospace;
                                    background: var(--chip);
                                    border: 1px solid var(--bd);
                                    border-radius: 6px;
                                    padding: 8px;
                                    word-break: break-all;
                                    font-size: 12px;
                                    color: var(--fg);
                                ">${cred.token || '<span style="color: var(--muted);">æœªè®¾ç½®</span>'}</div>
                            </div>
                            <div>
                                <div style="color: var(--muted); font-weight: 500; margin-bottom: 4px;">SubToken (ç”¨é‡æŸ¥çœ‹):</div>
                                <div style="
                                    font-family: ui-monospace, monospace;
                                    background: var(--chip);
                                    border: 1px solid var(--bd);
                                    border-radius: 6px;
                                    padding: 8px;
                                    word-break: break-all;
                                    font-size: 12px;
                                ">${subTokenDisplay}</div>
                            </div>
                        </div>
                    </div>

                    ${cred.lastBalance || cred.lastIncluded || cred.lastEndDate ? `
                    <div style="background: var(--panel); border: 1px solid var(--bd); border-radius: 8px; padding: 16px;">
                        <h4 style="margin: 0 0 12px 0; color: var(--fg); font-size: 14px; font-weight: 600;">è´¦æˆ·çŠ¶æ€</h4>
                        <div style="display: grid; gap: 8px; font-size: 14px;">
                            ${cred.lastBalance ? `
                            <div style="display: grid; grid-template-columns: 80px 1fr; gap: 12px;">
                                <span style="color: var(--muted); font-weight: 500;">ä½™é¢:</span>
                                <span style="color: var(--fg);">${cred.lastBalance}</span>
                            </div>` : ''}
                            ${cred.lastIncluded ? `
                            <div style="display: grid; grid-template-columns: 80px 1fr; gap: 12px;">
                                <span style="color: var(--muted); font-weight: 500;">æ€»é¢åº¦:</span>
                                <span style="color: var(--fg);">${cred.lastIncluded}</span>
                            </div>` : ''}
                            ${cred.lastEndDate ? `
                            <div style="display: grid; grid-template-columns: 80px 1fr; gap: 12px;">
                                <span style="color: var(--muted); font-weight: 500;">åˆ°æœŸæ—¶é—´:</span>
                                <span style="color: var(--fg);">${new Date(cred.lastEndDate).toLocaleString()}</span>
                            </div>` : ''}
                        </div>
                    </div>` : ''}
                </div>

                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                    <button id="copy-details" class="btn btn-secondary">ğŸ“‹ å¤åˆ¶ä¿¡æ¯</button>
                    <button id="close-details-btn" class="btn btn-primary">å…³é—­</button>
                </div>
            `;

            overlay.appendChild(dialog);
            document.body.appendChild(overlay);

            // ç»‘å®šäº‹ä»¶
            const closeDialog = () => overlay.remove();
            dialog.querySelector('#close-details').onclick = closeDialog;
            dialog.querySelector('#close-details-btn').onclick = closeDialog;

            // å¤åˆ¶è¯¦æƒ…åŠŸèƒ½
            dialog.querySelector('#copy-details').onclick = () => {
                const detailsText = `å‡­è¯è¯¦æƒ…:
ID: ${cred.id || 'N/A'}
é‚®ç®±: ${cred.email || 'æœªè®¾ç½®'}
ç§Ÿæˆ·: ${cred.tenant || 'æœªè®¾ç½®'}
Token: ${cred.token || 'æœªè®¾ç½®'}
SubToken: ${cred.subToken || 'æœªè®¾ç½®'}
${cred.subToken ? `ç”¨é‡æŸ¥çœ‹é“¾æ¥: https://portal.withorb.com/view?token=${cred.subToken}` : ''}
${cred.lastBalance ? `ä½™é¢: ${cred.lastBalance}` : ''}
${cred.lastIncluded ? `æ€»é¢åº¦: ${cred.lastIncluded}` : ''}
${cred.lastEndDate ? `åˆ°æœŸæ—¶é—´: ${new Date(cred.lastEndDate).toLocaleString()}` : ''}`;

                navigator.clipboard?.writeText(detailsText).then(() => {
                    showToast('è¯¦æƒ…å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                }).catch(() => {
                    showToast('å¤åˆ¶å¤±è´¥', 'error');
                });
            };

            // ç‚¹å‡»èƒŒæ™¯å…³é—­
            overlay.onclick = (e) => {
                if (e.target === overlay) closeDialog();
            };
        }

        // åˆ é™¤å‡­è¯
        function deleteCredential(id) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå‡­è¯å—ï¼Ÿ')) {
                const creds = store.get();
                const newCreds = creds.filter(c => c.id != id);
                store.set(newCreds);
                showToast('å‡­è¯å·²åˆ é™¤', 'success');
                showCredentialManagement(); // åˆ·æ–°æ˜¾ç¤º
            }
        }

        // å…¨éƒ¨æ£€æµ‹åŠŸèƒ½
        async function checkAllCredentials() {
            const creds = store.get();
            if (creds.length === 0) {
                showToast('æ²¡æœ‰å‡­è¯éœ€è¦æ£€æµ‹', 'info');
                return;
            }

            showToast(`å¼€å§‹æ£€æµ‹ ${creds.length} ä¸ªå‡­è¯...`, 'info');

            // æ˜¾ç¤ºæ‰€æœ‰å¡ç‰‡çš„æ£€æµ‹çŠ¶æ€
            creds.forEach(cred => showCredentialLoading(cred.id, true));

            let completed = 0;
            const results = { success: 0, error: 0 };

            // å¹¶å‘æ£€æµ‹ï¼Œé™åˆ¶å¹¶å‘æ•°
            const concurrency = CFG.CONCURRENCY || 4;
            const tasks = creds.map(cred => async () => {
                try {
                    const status = await balance.check(cred);
                    results.success++;
                    console.log(`å‡­è¯ ${cred.email} æ£€æµ‹å®Œæˆ: ${status}`);
                } catch (error) {
                    results.error++;
                    console.error(`å‡­è¯ ${cred.email} æ£€æµ‹å¤±è´¥:`, error);
                } finally {
                    completed++;
                    showCredentialLoading(cred.id, false);

                    // æ›´æ–°è¿›åº¦
                    if (completed % 2 === 0 || completed === creds.length) {
                        showToast(`æ£€æµ‹è¿›åº¦: ${completed}/${creds.length}`, 'info');
                    }
                }
            });

            // æ‰§è¡Œå¹¶å‘ä»»åŠ¡
            await runConcurrentTasks(tasks, concurrency);

            // æ˜¾ç¤ºæœ€ç»ˆç»“æœ
            showToast(`æ£€æµ‹å®Œæˆï¼æˆåŠŸ: ${results.success}, å¤±è´¥: ${results.error}`, 'success');

            // åˆ·æ–°æ˜¾ç¤º
            showCredentialManagement();
        }

        // AURA-Xåè®®ï¼šæ£€æµ‹æ‰€æœ‰æ­£å¸¸å‡­è¯åŠŸèƒ½
        async function checkAllActiveCredentials() {
            const creds = store.get();
            const activeCreds = creds.filter(c => c.status === 'ACTIVE');

            if (activeCreds.length === 0) {
                showToast('æ²¡æœ‰æ­£å¸¸å‡­è¯éœ€è¦æ£€æµ‹', 'info');
                return;
            }

            showToast(`å¼€å§‹æ£€æµ‹ ${activeCreds.length} ä¸ªæ­£å¸¸å‡­è¯...`, 'info');

            // æ˜¾ç¤ºæ‰€æœ‰æ­£å¸¸å‡­è¯çš„æ£€æµ‹ä¸­çŠ¶æ€
            activeCreds.forEach(cred => showCredentialLoading(cred.id, true));

            const results = { success: 0, error: 0 };

            // å¹¶å‘æ£€æµ‹ï¼Œé™åˆ¶å¹¶å‘æ•°
            const concurrency = CFG.CONCURRENCY || 4;
            const tasks = activeCreds.map(cred => async () => {
                try {
                    const status = await balance.check(cred);
                    results.success++;
                    console.log(`æ­£å¸¸å‡­è¯ ${cred.email} æ£€æµ‹å®Œæˆ: ${status}`);
                } catch (error) {
                    results.error++;
                    console.error(`æ­£å¸¸å‡­è¯ ${cred.email} æ£€æµ‹å¤±è´¥:`, error);
                } finally {
                    showCredentialLoading(cred.id, false);
                }
            });

            // æ‰§è¡Œå¹¶å‘ä»»åŠ¡
            await runConcurrentTasks(tasks, concurrency);

            // æ˜¾ç¤ºæœ€ç»ˆç»“æœ
            showToast(`æ­£å¸¸å‡­è¯æ£€æµ‹å®Œæˆï¼æˆåŠŸ: ${results.success}, å¤±è´¥: ${results.error}`, 'success');

            // åˆ·æ–°æ˜¾ç¤º
            showCredentialManagement();
        }

        // å¹¶å‘ä»»åŠ¡æ‰§è¡Œå™¨
        async function runConcurrentTasks(tasks, limit) {
            return new Promise(resolve => {
                let index = 0;
                let running = 0;
                let completed = 0;

                const next = () => {
                    while (running < limit && index < tasks.length) {
                        const taskIndex = index++;
                        running++;
                        tasks[taskIndex]().finally(() => {
                            running--;
                            completed++;
                            next();
                        });
                    }
                    if (completed === tasks.length) {
                        resolve();
                    }
                };
                next();
            });
        }

        // CORSæ£€æµ‹å’ŒçŠ¶æ€ç®¡ç†
        const corsManager = {
            async checkAPI(url, timeout = 5000) {
                try {
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), timeout);

                    const response = await fetch(url, {
                        method: 'HEAD',
                        mode: 'cors',
                        signal: controller.signal
                    });

                    clearTimeout(timeoutId);
                    return response.ok || response.status === 404; // 404ä¹Ÿç®—å¯è®¿é—®
                } catch (error) {
                    console.log(`APIæ£€æµ‹å¤±è´¥ ${url}:`, error.message);
                    return false;
                }
            },

            async checkAllAPIs() {
                console.log('å¼€å§‹æ£€æµ‹APIè¿æ¥çŠ¶æ€...');

                const authCheck = this.checkAPI(CFG.authURL);
                const orbCheck = this.checkAPI(CFG.orbAPI + '/ping');

                const [authOk, orbOk] = await Promise.all([authCheck, orbCheck]);

                CFG.API_STATUS.auth = authOk ? 'ok' : 'blocked';
                CFG.API_STATUS.orb = orbOk ? 'ok' : 'blocked';

                const allOk = authOk && orbOk;

                console.log('APIæ£€æµ‹ç»“æœ:', {
                    auth: CFG.API_STATUS.auth,
                    orb: CFG.API_STATUS.orb,
                    allOk
                });

                // å¦‚æœAPIä¸å¯ç”¨ï¼Œæç¤ºä½¿ç”¨ä»£ç†
                if (!allOk) {
                    console.log('æ£€æµ‹åˆ°CORSé—®é¢˜ï¼Œå»ºè®®ä½¿ç”¨å…¬å…±CORSä»£ç†');
                }

                return allOk;
            }
        };

        // é¡µé¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('é¡µé¢å¼€å§‹åˆå§‹åŒ–...');

            try {
                // æµ‹è¯•åŸºç¡€å‡½æ•°
                console.log('æµ‹è¯•$å‡½æ•°:', typeof $ === 'function');
                console.log('æµ‹è¯•storeå¯¹è±¡:', typeof store === 'object');
                console.log('æµ‹è¯•actionså¯¹è±¡:', typeof actions === 'object');

                // CORSåŠŸèƒ½å·²åˆ é™¤
                // await corsManager.checkAllAPIs();

                // ä¸æ³¨å…¥æµ‹è¯•æ•°æ®

                // åˆå§‹åŒ–ä¸»é¢˜ï¼ˆé»˜è®¤ç®€çº¦é£ï¼Œè‹¥ä¹‹å‰é€‰æ‹©è¿‡åˆ™ä¿æŒï¼‰
                try {
                    const savedTheme = localStorage.getItem(THEME_KEY) || 'default';
                    applyTheme(savedTheme);
                } catch {}

                // ç»‘å®šäº‹ä»¶
                const navAuth = $('#nav-auth');
                const navCheckAll = $('#nav-checkall');
                const navImport = $('#nav-import');
                const navExport = $('#nav-export');
                const navTheme = $('#nav-theme');

                console.log('æ‰¾åˆ°çš„å…ƒç´ :', {
                    navAuth: !!navAuth,
                    navCheckAll: !!navCheckAll,
                    navImport: !!navImport,
                    navExport: !!navExport,
                    navTheme: !!navTheme
                });

                if (navAuth) {
                    navAuth.onclick = actions.auth;
                    console.log('è·å–ä»¤ç‰ŒæŒ‰é’®ç»‘å®šå®Œæˆ');
                }
                if (navCheckAll) {
                    navCheckAll.onclick = checkAllCredentials;
                    console.log('å…¨éƒ¨æ£€æµ‹æŒ‰é’®ç»‘å®šå®Œæˆ');
                }
                if (navImport) {
                    navImport.onclick = actions.import;
                    console.log('å¯¼å…¥æ•°æ®æŒ‰é’®ç»‘å®šå®Œæˆ');
                }
                if (navExport) {
                    navExport.onclick = actions.export;
                    console.log('å¯¼å‡ºæ•°æ®æŒ‰é’®ç»‘å®šå®Œæˆ');
                }
                const navSync = $('#nav-sync');
                if (navSync) {
                    navSync.onclick = showSyncDialog;
                    console.log('äº‘åŒæ­¥æŒ‰é’®ç»‘å®šå®Œæˆ');
                }
                const navProxy = $('#nav-proxy');
                if (navProxy) {
                    navProxy.onclick = showProxyManagerDialog;
                    console.log('ä»£ç†é…ç½®æŒ‰é’®ç»‘å®šå®Œæˆ');
                }
                if (navTheme) {
                    navTheme.onclick = toggleTheme;
                    setThemeButtonLabel();
                    console.log('é£æ ¼åˆ‡æ¢æŒ‰é’®ç»‘å®šå®Œæˆ');
                }

                // éšè—åŠ è½½ï¼Œæ˜¾ç¤ºå°±ç»ªçŠ¶æ€ï¼Œå¹¶ç›´æ¥æ˜¾ç¤ºå‡­è¯ç®¡ç†ç•Œé¢
                setTimeout(() => {
                    try {
                        const loading = $('#loading');
                        const ready = $('#ready');
                        if (loading) loading.style.display = 'none';
                        if (ready) ready.style.display = 'block';
                        console.log('é¡µé¢åˆå§‹åŒ–å®Œæˆ');
                        showToast('âœ… åº”ç”¨ç¨‹åºå·²å°±ç»ªï¼', 'success');

                        // ç›´æ¥æ˜¾ç¤ºå‡­è¯ç®¡ç†ç•Œé¢
                        showCredentialManagement();
                    } catch (timeoutError) {
                        console.error('å»¶è¿Ÿåˆå§‹åŒ–å¤±è´¥:', timeoutError);
                    }
                }, 1000);

            } catch (error) {
                console.error('åˆå§‹åŒ–å¤±è´¥:', error);
                const loading = $('#loading');
                if (loading) {
                    loading.innerHTML = `
                        <h3 style="color: #ef4444;">åˆå§‹åŒ–å¤±è´¥</h3>
                        <p>é”™è¯¯: ${error.message}</p>
                        <p>å †æ ˆ: ${error.stack}</p>
                        <button class="btn btn-primary" onclick="location.reload()">é‡æ–°åŠ è½½</button>
                    `;
                }
            }
        });
        
        console.log('è„šæœ¬åŠ è½½å®Œæˆ');
    </script>
</body>
</html>
